

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>zonal statistics using rasterstats &#8212; space cameras and glaciers</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=ac02cc09edc035673794" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    <link rel="stylesheet" href="../../../_static/customstyle.css" type="text/css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=ac02cc09edc035673794" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794" />
  <script src="../../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=ac02cc09edc035673794"></script>

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'teaching/egm722/practicals/zonalstats';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="help! something went wrong!" href="../faq/index.html" />
    <link rel="prev" title="searching + downloading satellite data using earthaccess" href="earthaccess.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    <p class="title logo__title">space cameras and glaciers</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../whataboutbob.html">about me</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../../index.html">teaching</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="../../egm101/index.html">EGM101: skills toolbox</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../egm101/lectures.html">lectures</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../egm101/practicals/index.html">practicals</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../egm101/practicals/week5.html">computation, summary statistics, and graphing in excel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../egm101/practicals/week6.html">summarizing and graphing data in spss</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../egm101/practicals/week7.html">correlation and regression in spss</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../egm101/practicals/week8.html">hypothesis testing using spss</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../egm101/resources.html">additional resources</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../egm310/index.html">EGM310: introduction to gis and remote sensing</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../egm310/lectures.html">lectures</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../egm310/resources.html">additional resources</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../egm702/index.html">EGM702: photogrammetry and advanced image analysis</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../egm702/lectures.html">lectures</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../egm702/practicals/index.html">practicals</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../egm702/practicals/setup.html">software setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../egm702/practicals/week1.html">dem processing using micmac</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../egm702/practicals/week2.html">dem differencing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../egm702/practicals/week3.html">introduction to google earth engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../egm702/practicals/week4.html">change detection in earth engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../egm702/practicals/week5.html">classification in earth engine</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../egm702/resources.html">additional resources</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../egm703/index.html">EGM703: advanced active and passive remote sensing</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../egm703/lectures.html">lectures</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../egm703/practicals/index.html">practicals</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../egm703/practicals/week1.html">urban heat islands</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../egm703/practicals/week2.html">hyperspectral image analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../egm703/practicals/week3.html">SAR image processing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../egm703/practicals/week4.html">InSAR Processing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../egm703/practicals/week5.html">SAR image interpretation and flood mapping</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../egm703/resources.html">additional resources</a></li>
</ul>
</li>
<li class="toctree-l2 current active has-children"><a class="reference internal" href="../index.html">EGM722: programming for gis and remote sensing</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l3 has-children"><a class="reference internal" href="../setup/index.html">setup</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../setup/github.html">setting up github</a></li>
<li class="toctree-l4"><a class="reference internal" href="../setup/git.html">installing git</a></li>
<li class="toctree-l4"><a class="reference internal" href="../setup/desktop.html">installing github desktop</a></li>
<li class="toctree-l4"><a class="reference internal" href="../setup/fork.html">forking the repository</a></li>
<li class="toctree-l4"><a class="reference internal" href="../setup/clone.html">cloning the repository</a></li>
<li class="toctree-l4"><a class="reference internal" href="../setup/conda.html">setting up conda/anaconda</a></li>
<li class="toctree-l4"><a class="reference internal" href="../setup/environment.html">setting up a conda environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../setup/jupyter.html">configuring jupyter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../setup/pycharm.html">pycharm</a></li>
<li class="toctree-l4"><a class="reference internal" href="../setup/pip.html">installing packages with pip</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../lectures.html">lectures</a></li>
<li class="toctree-l3 current active has-children"><a class="reference internal" href="index.html">practicals</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="pythonintro.html">intro to python</a></li>
<li class="toctree-l4"><a class="reference internal" href="debugging.html">debugging exercise</a></li>
<li class="toctree-l4"><a class="reference internal" href="cartopy.html">mapping with cartopy</a></li>
<li class="toctree-l4"><a class="reference internal" href="conflicts.html">conflict resolution (using git)</a></li>
<li class="toctree-l4"><a class="reference internal" href="vector.html">vector data using shapely and geopandas</a></li>
<li class="toctree-l4"><a class="reference internal" href="folium.html">interactive maps with folium</a></li>
<li class="toctree-l4"><a class="reference internal" href="raster.html">raster data using rasterio</a></li>
<li class="toctree-l4"><a class="reference internal" href="earthaccess.html">searching + downloading satellite data using earthaccess</a></li>
<li class="toctree-l4 current active"><a class="current reference internal" href="#">zonal statistics using rasterstats</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../faq/index.html">help! something went wrong!</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../faq/git.html">git troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../faq/python.html">python troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../project/index.html">programming project</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-13"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../project/github.html">creating a new github repository</a></li>
<li class="toctree-l4"><a class="reference internal" href="../project/environment.html">environment.yml</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../resources.html">additional resources</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../unis/index.html">unis glaciology (AG-325)</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-14"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../unis/optical.html">mapping glacier area change</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../unis/dems.html">dem differencing and geodetic mass balance</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../python-programming/index.html">programming skills for phd researchers (using python)</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-15"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../python-programming/setup/index.html">setup</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-16"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../python-programming/setup/github.html">setting up github</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../python-programming/setup/git.html">installing git</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../python-programming/setup/desktop.html">installing github desktop</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../python-programming/setup/fork.html">forking the repository</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../python-programming/setup/clone.html">cloning the repository</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../python-programming/setup/conda.html">setting up conda/anaconda</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../python-programming/setup/environment.html">setting up a conda environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../python-programming/setup/jupyter.html">configuring the jupyterlab terminal</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../python-programming/setup/pycharm.html">pycharm</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../python-programming/lectures.html">lectures</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../python-programming/exercises/index.html">exercises</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-17"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../python-programming/exercises/git.html">introduction to version control using git</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../python-programming/exercises/project.html">starting a new project</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../python-programming/exercises/intro.html">introduction to python using jupyterlab</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../python-programming/exercises/debugging.html">debugging code</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../python-programming/exercises/plotting.html">plotting data using seaborn</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../python-programming/exercises/pandas.html">working with pandas dataframes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../python-programming/exercises/stats.html">basic statistical analysis using python</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../python-programming/exercises/regression.html">linear regression using python</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../python-programming/resources.html">additional resources</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../r-programming/index.html">programming skills for phd researchers (using R)</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-18"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../r-programming/setup/index.html">setup</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-19"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../r-programming/setup/github.html">setting up github</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../r-programming/setup/git.html">installing git</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../r-programming/setup/desktop.html">installing github desktop</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../r-programming/setup/fork.html">forking the repository</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../r-programming/setup/clone.html">cloning the repository</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../r-programming/setup/conda.html">setting up conda/anaconda</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../r-programming/setup/environment.html">setting up a conda environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../r-programming/setup/jupyter.html">configuring jupyterlab</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../r-programming/lectures.html">lectures</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../r-programming/exercises/index.html">exercises</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-20"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../r-programming/exercises/git.html">introduction to version control using git</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../r-programming/exercises/project.html">starting a new project</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../r-programming/exercises/rintro.html">introduction to <strong>R</strong> using jupyterlab</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../r-programming/exercises/debugging.html">debugging code</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../r-programming/exercises/plotting.html">plotting data using ggplot2</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../r-programming/exercises/transform.html">transforming data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../r-programming/exercises/stats.html">basic statistical analysis using <strong>R</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../r-programming/exercises/regression.html">linear regression using <strong>R</strong></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../r-programming/resources.html">additional resources</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../hpc-intro/index.html">introduction to high performance computing</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-21"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../hpc-intro/setup.html">setup</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../hpc-intro/shell/index.html">the unix shell</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-22"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../hpc-intro/shell/shell.html">in the beginning was the command line</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../hpc-intro/shell/navigation.html">navigating on the command line</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../hpc-intro/shell/files.html">working with files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../hpc-intro/shell/input.html">input/output</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../hpc-intro/shell/scripts.html">shell scripts</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../hpc-intro/hpc/index.html">high performance computing</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-23"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../hpc-intro/hpc/atlas.html">atlas</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../hpc-intro/hpc/data_transfer.html">transferring data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../hpc-intro/hpc/vulcan.html">vulcan</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../hpc-intro/resources.html">additional resources</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../dissertation/index.html">undergraduate dissertation projects</a><input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-24"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../dissertation/glaciers.html">mapping glacier changes over time</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dissertation/glacial_lakes.html">detection of supraglacial lakes and timing of drainage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dissertation/algae.html">mapping harmful algal blooms using satellite remote sensing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dissertation/floods.html">flood detection and monitoring using remote sensing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dissertation/wildfires.html">detection and mapping of wildfires</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dissertation/heat_islands.html">urban heat islands</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../gee/index.html">google earth engine</a><input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-25"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../gee/tutorials/index.html">gee tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-26"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../gee/tutorials/getting_started/index.html">getting started</a><input class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-27"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../gee/tutorials/getting_started/adding_exporting.html">adding and exporting images</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../gee/tutorials/getting_started/spectral.html">spectral signatures</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../gee/tutorials/getting_started/image_collections.html">image collections and vectors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../gee/tutorials/getting_started/mapping.html">manual mapping (digitizing)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../gee/tutorials/getting_started/band_maths.html">band maths</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../gee/tutorials/getting_started/zonal_stats.html">zonal statistics</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../gee/tutorials/classification/index.html">image classification</a><input class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-28"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../gee/tutorials/classification/unsupervised.html">unsupervised classification</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../gee/tutorials/classification/pixel.html">pixel-based classification</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../gee/tutorials/classification/obia.html">object-based classification</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../gee/tutorials/change_detection/index.html">change detection</a><input class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-29"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../gee/tutorials/change_detection/visual_analysis.html">visual analysis of changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../gee/tutorials/change_detection/thresholding.html">band maths and thresholding</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../gee/tutorials/change_detection/repeat_classification.html">repeat classification</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../gee/tutorials/change_detection/cva.html">change vector analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../gee/tutorials/change_detection/time_series.html">time series analysis</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../gee/tutorials/enhancement/index.html">image enhancement</a><input class="toctree-checkbox" id="toctree-checkbox-30" name="toctree-checkbox-30" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-30"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../gee/tutorials/enhancement/filtering.html">image filtering</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../gee/tutorials/enhancement/pansharpening.html">pansharpening</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../gee/tutorials/enhancement/edge_detection.html">edge detection</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../gee/tutorials/enhancement/unmixing.html">spectral unmixing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../gee/tutorials/enhancement/pca.html">principle component analysis</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../gee/tutorials/advanced/index.html">advanced topics</a><input class="toctree-checkbox" id="toctree-checkbox-31" name="toctree-checkbox-31" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-31"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../gee/tutorials/advanced/animation.html">creating an animation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../gee/exercises/index.html">sample exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../research/index.html">ongoing and past research projects</a><input class="toctree-checkbox" id="toctree-checkbox-32" name="toctree-checkbox-32" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-32"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../research/dar.html">deplete and retreat (DaR)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../writing/index.html">selected writing samples</a><input class="toctree-checkbox" id="toctree-checkbox-33" name="toctree-checkbox-33" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-33"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../writing/source.html">source magazine (summer 2022)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../github.html">github projects</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/iamdonovan/iamdonovan.github.io" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/iamdonovan/iamdonovan.github.io/edit/main/teaching/egm722/practicals/zonalstats.rst" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/iamdonovan/iamdonovan.github.io/issues/new?title=Issue%20on%20page%20%2Fteaching/egm722/practicals/zonalstats.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/teaching/egm722/practicals/zonalstats.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>zonal statistics using rasterstats</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-started">getting started</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nick-cassavetes">Nick Cassavetes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">overview</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#objectives">objectives</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-provided">data provided</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">getting started</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#zonal-statistics">zonal statistics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-zip-built-in">the zip built-in</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#handling-exceptions-with-try-except">handling Exceptions with try … except</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rasterizing-vector-data-using-rasterio">rasterizing vector data using rasterio</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#masking-and-indexing-rasters">masking and indexing rasters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next steps</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#footnotes">Footnotes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="section" id="zonal-statistics-using-rasterstats">
<h1>zonal statistics using rasterstats<a class="headerlink" href="#zonal-statistics-using-rasterstats" title="Permalink to this heading">#</a></h1>
<p>In this practical, we’ll see how we can combine vector and raster data for different analyses, including computing
zonal statistics for a raster, and rasterizing a vector dataset.</p>
<p>The practical this week is provided as a Jupyter Notebook, which you can use to interactively work through the
different steps of the practical.</p>
<div class="section" id="getting-started">
<h2>getting started<a class="headerlink" href="#getting-started" title="Permalink to this heading">#</a></h2>
<p>To get started with this week’s practical, you’ll need to first <strong>merge</strong> the <code class="docutils literal notranslate"><span class="pre">week5</span></code> branch into the <code class="docutils literal notranslate"><span class="pre">main</span></code> branch,
using <strong>one</strong> of the methods we’ve seen in previous weeks:</p>
<ul class="simple">
<li><p>using <strong>GitHub Desktop</strong> [<a class="reference internal" href="cartopy.html"><span class="doc">week2</span></a>]</p></li>
<li><p>using the <strong>git</strong> command-line interface [<a class="reference internal" href="vector.html"><span class="doc">week3</span></a>]</p></li>
<li><p>using a <strong>Pull Request</strong> [<a class="reference internal" href="raster.html"><span class="doc">week4</span></a>]</p></li>
</ul>
<p>Make sure that you have merged <code class="docutils literal notranslate"><span class="pre">week5</span></code> into <code class="docutils literal notranslate"><span class="pre">main</span></code> using one of the methods outlined above before starting the
practical.</p>
<p>The other thing you’ll need to do before starting this week’s practical is install a new python package,
<strong>rasterstats</strong>, using <strong>conda</strong> via the command prompt.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can also install this package using <strong>Anaconda Navigator</strong>, as we did during the Week 4 SentinelSat exercise,
but the following instructions are designed to give you some more experience using the <strong>conda</strong> CLI.</p>
</div>
<p>To do this, open the <code class="docutils literal notranslate"><span class="pre">egm722</span></code> command prompt, then type the following command:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>conda install -c conda-forge rasterstats
</pre></div>
</div>
<p>Press <strong>Enter</strong>. You should see something like the following (it may take a minute):</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../_images/conda_install.png"><img alt="conda install running in the command prompt" src="../../../_images/conda_install.png" style="width: 720px;" /></a>
</div>
<p>Type <code class="docutils literal notranslate"><span class="pre">y</span></code> and press <strong>Enter</strong>, and <strong>conda</strong> will install <strong>rasterstats</strong> into your current environment (<code class="docutils literal notranslate"><span class="pre">egm722</span></code>).
Enter the following command:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>conda list
</pre></div>
</div>
<p>You should see <strong>rasterstats</strong> included in the output of this command (you may need to scroll up to see it):</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../_images/conda_list.png"><img alt="the output of conda list in the command prompt, showing that rasterstats is installed" src="../../../_images/conda_list.png" style="width: 720px;" /></a>
</div>
<p>At this point, you can launch Jupyter Notebooks from the command prompt, or from Anaconda Navigator, and begin to work
through the notebook.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Below this point is the <strong>non-interactive</strong> text of the notebook. To actually run the notebook, you’ll need to
follow the instructions above to open the notebook and run it on your own computer!</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="nick-cassavetes">
<h2>Nick Cassavetes<a class="headerlink" href="#nick-cassavetes" title="Permalink to this heading">#</a></h2>
<div class="section" id="overview">
<h3>overview<a class="headerlink" href="#overview" title="Permalink to this heading">#</a></h3>
<p>Up to now, we have worked with either vector data or raster data, but we
haven’t really used them together. In this week’s practical, we’ll learn
how we can combine these two data types, and see some examples of
different analyses, such as zonal statistics or sampling raster data,
that we can automate using python.</p>
</div>
<div class="section" id="objectives">
<h3>objectives<a class="headerlink" href="#objectives" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>learn how to use <code class="docutils literal notranslate"><span class="pre">rasterstats</span></code> to perform zonal statistics</p></li>
<li><p>use the <code class="docutils literal notranslate"><span class="pre">zip</span></code> built-in to combine iterables such as lists</p></li>
<li><p>learn how to handle exceptions using <code class="docutils literal notranslate"><span class="pre">try</span></code> … <code class="docutils literal notranslate"><span class="pre">except</span></code> blocks</p></li>
<li><p>rasterize polygon data using <code class="docutils literal notranslate"><span class="pre">rasterio</span></code></p></li>
<li><p>learn how to mask and select (index) rasters using vector data</p></li>
<li><p>see additional plotting examples using <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code></p></li>
</ul>
</div>
<div class="section" id="data-provided">
<h3>data provided<a class="headerlink" href="#data-provided" title="Permalink to this heading">#</a></h3>
<p>In the data_files folder, you should have the following: -
LCM2015_Aggregate_100m.tif - NI_DEM.tif</p>
</div>
<div class="section" id="id1">
<h3>getting started<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<p>In this practical, we’ll look at a number of different GIS tasks related
to working with both raster and vector data in python, as well as a few
different python and programming concepts. To get started, run the cell
below.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">rasterio</span> <span class="k">as</span> <span class="nn">rio</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">rasterstats</span>
</pre></div>
</div>
</div>
<div class="section" id="zonal-statistics">
<h3>zonal statistics<a class="headerlink" href="#zonal-statistics" title="Permalink to this heading">#</a></h3>
<p>In GIS, <a class="reference external" href="https://pro.arcgis.com/en/pro-app/latest/tool-reference/spatial-analyst/how-zonal-statistics-works.htm">zonal
statistics</a>
is a process whereby you calculate statistics for the pixels of a raster
in different groups, or zones, defined by properties in another dataset.
In this example, we’re going to use the Northern Ireland County border
dataset from Week 2, along with a re-classified version of the Northern
Ireland <a class="reference external" href="https://catalogue.ceh.ac.uk/documents/47f053a0-e34f-4534-a843-76f0a0998a2f">Land Cover
Map</a>
2015<a class="reference external" href="#fn1">1</a>.</p>
<p>The Land Cover Map tells, for each pixel, what type of land cover is
associated with a location - that is, whether it’s woodland (and what
kind of woodland), grassland, urban or built-up areas, and so on. For
our re-classified version of the dataset, we’re working with the
aggregate class data, re-sampled to 100m resolution from the original
25m resolution.</p>
<p>The raster data type is <em>unsigned integer</em> with a <em>bitdepth</em> of 8 bits -
that is, it has a range of possible values from 0 to 255. Even though it
has this range of possible values, we only use 10 (11) of them:</p>
<table class="table">
<colgroup>
<col style="width: 32%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Raster value</p></th>
<th class="head"><p>Aggregate class name</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>No Data</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>Broadleaf woodland</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>Coniferous woodland</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>Arable</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>Improved grassland</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p>Semi-natural grassland</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td><p>Mountain, heath, bog</p></td>
</tr>
<tr class="row-odd"><td><p>7</p></td>
<td><p>Saltwater</p></td>
</tr>
<tr class="row-even"><td><p>8</p></td>
<td><p>Freshwater</p></td>
</tr>
<tr class="row-odd"><td><p>9</p></td>
<td><p>Coastal</p></td>
</tr>
<tr class="row-even"><td><p>10</p></td>
<td><p>Built-up areas and gardens</p></td>
</tr>
</tbody>
</table>
<p>In the cell below, we’ll first define a <strong>list</strong> of landcover class
names, in the order shown in the table above. Then, we’ll use
<code class="docutils literal notranslate"><span class="pre">range()</span></code> to create a list of values from 1 to 10, corresponding to
the raster value of each landcover class.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define the landcover class names in a list</span>
<span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Broadleaf woodland&#39;</span><span class="p">,</span> <span class="s1">&#39;Coniferous woodland&#39;</span><span class="p">,</span> <span class="s1">&#39;Arable&#39;</span><span class="p">,</span> <span class="s1">&#39;Improved grassland&#39;</span><span class="p">,</span> <span class="s1">&#39;Semi-natural grassland&#39;</span><span class="p">,</span>
         <span class="s1">&#39;Mountain, heath, bog&#39;</span><span class="p">,</span> <span class="s1">&#39;Saltwater&#39;</span><span class="p">,</span> <span class="s1">&#39;Freshwater&#39;</span><span class="p">,</span> <span class="s1">&#39;Coastal&#39;</span><span class="p">,</span> <span class="s1">&#39;Built-up areas and gardens&#39;</span><span class="p">]</span>

<span class="n">values</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span> <span class="c1"># get numbers from 1-10, corresponding to the landcover values</span>
</pre></div>
</div>
<p>Next, we’ll use a combination of the <code class="docutils literal notranslate"><span class="pre">zip()</span></code> built-in function
(<a class="reference external" href="https://docs.python.org/3/library/functions.html#zip">documentation</a>),
along with <code class="docutils literal notranslate"><span class="pre">dict()</span></code>
(<a class="reference external" href="https://docs.python.org/3/library/functions.html#func-dict">documentation</a>),
to create a <strong>dict</strong> object of <strong>key</strong>/<strong>value</strong> pairs that maps each
raster value (the <strong>key</strong>) to a class name (the <strong>value</strong>):</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">landcover_names</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">names</span><span class="p">))</span> <span class="c1"># create a dict of landcover value/name pairs</span>
</pre></div>
</div>
<p>We’ll use this later on, when we want to make our outputs more
readable/understandable.</p>
<p>In this part of the practical, we’ll try to work out the percentage of
the entire country, and of each county individually, that is covered by
each of these different landcovers.</p>
<p>To start, we’ll load the <code class="docutils literal notranslate"><span class="pre">LCM2015_Aggregate_100m.tif</span></code> raster, as well
as the counties shapefile from Week 2:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># open the land cover raster and read the data</span>
<span class="k">with</span> <span class="n">rio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;data_files/LCM2015_Aggregate_100m.tif&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dataset</span><span class="p">:</span>
    <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">bounds</span>
    <span class="n">crs</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">crs</span>
    <span class="n">landcover</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">affine_tfm</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">transform</span>

<span class="c1"># now, load the county dataset from the week 2 folder</span>
<span class="n">counties</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;../Week2/data_files/Counties.shp&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, we’ll define a function that takes an array, and returns a
<strong>dict</strong> object containing the count (number of pixels) for each of the
unique values in the array:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">count_unique</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">nodata</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Count the unique elements of an array.</span>

<span class="sd">    :param array: Input array</span>
<span class="sd">    :param names: a dict of key/value pairs that map raster values to a name</span>
<span class="sd">    :param nodata: nodata value to ignore in the counting</span>

<span class="sd">    :returns count_dict: a dictionary of unique values and counts</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">count_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span> <span class="c1"># create the output dict</span>
    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">array</span><span class="p">):</span> <span class="c1"># iterate over the unique values for the raster</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">:</span> <span class="c1"># if the value is equal to our nodata value, move on to the next one</span>
            <span class="k">continue</span>
        <span class="n">count_dict</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="n">val</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">array</span> <span class="o">==</span> <span class="n">val</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">count_dict</span> <span class="c1"># return the now-populated output dict</span>
</pre></div>
</div>
<p>Here, we have three input parameters: the first, <code class="docutils literal notranslate"><span class="pre">array</span></code>, is our array
(or raster data). The next, <code class="docutils literal notranslate"><span class="pre">names</span></code>, is a dict of <strong>key</strong>/<strong>value</strong>
pairs to provide human-readable names for each raster value. Finally,
<code class="docutils literal notranslate"><span class="pre">nodata</span></code> is the value of the input array that we should ignore.</p>
<p>The first line of the function defines an empty <strong>dict</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">count_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</pre></div>
</div>
<p>This is the empty container into which we’ll place the <strong>key</strong>/<strong>value</strong>
pairs corresponding to the count for each landcover class.</p>
<p>Next, using <code class="docutils literal notranslate"><span class="pre">numpy.unique()</span></code>
(<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.unique.html">documentation</a>),
we get an array containing the unique values of the input array.</p>
<p>Note that this works for data like this raster, where we have a limited
number of pre-defined values. For something like a digital elevation
model, which represents continuous floating-point values, we wouldn’t
want to use this approach to bin the data - we’ll see how we can handle
continuous data later on.</p>
<p>For each of the different unique values <code class="docutils literal notranslate"><span class="pre">val</span></code>, we find all of the
locations in <code class="docutils literal notranslate"><span class="pre">array</span></code> that have that value (<code class="docutils literal notranslate"><span class="pre">array</span> <span class="pre">==</span> <span class="pre">val</span></code>). Note
that this is actually a boolean array, with values of either <code class="docutils literal notranslate"><span class="pre">True</span></code>
where <code class="docutils literal notranslate"><span class="pre">array</span> <span class="pre">==</span> <span class="pre">val</span></code>, and <code class="docutils literal notranslate"><span class="pre">False</span></code> where <code class="docutils literal notranslate"><span class="pre">array</span> <span class="pre">!=</span> <span class="pre">val</span></code>.
<code class="docutils literal notranslate"><span class="pre">numpy.count_nonzero()</span></code>
(<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.count_nonzero.html">documentation</a>)
then counts the number of non-zero (in this case, <code class="docutils literal notranslate"><span class="pre">True</span></code>) values in
the array - that is, this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">array</span> <span class="o">==</span> <span class="n">val</span><span class="p">)</span>
</pre></div>
</div>
<p>tells us the number of pixels in <code class="docutils literal notranslate"><span class="pre">array</span></code> that are equal to <code class="docutils literal notranslate"><span class="pre">val</span></code>. We
then assign this to our dictionary with a key that is a <strong>str</strong>
representation of the value, before returning our <code class="docutils literal notranslate"><span class="pre">count_dict</span></code>
variable at the end of the function.</p>
<p>Run the cell below to run the function on our <code class="docutils literal notranslate"><span class="pre">landcover</span></code> raster:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">landcover_count</span> <span class="o">=</span> <span class="n">count_unique</span><span class="p">(</span><span class="n">landcover</span><span class="p">,</span> <span class="n">landcover_names</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">landcover_count</span><span class="p">)</span> <span class="c1"># show the results</span>
</pre></div>
</div>
<p>Exercise: can you work out the percentage area of Northern Ireland that
is covered by each of the 10 landcover classes?</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># start by using count_unique to get the number of pixels corresponding to each landcover class</span>

<span class="c1"># now, get the total number of pixels in the image that aren&#39;t nodata</span>
<span class="c1"># hint: use np.count_nonzero()</span>

<span class="c1"># now, iterate over the dictionary items to express the number of pixels as a percentage of the total pixels</span>
</pre></div>
</div>
<p>Now, let’s have a look at the help for <code class="docutils literal notranslate"><span class="pre">rasterstats.gen_zonal_stats()</span></code>
(<a class="reference external" href="https://pythonhosted.org/rasterstats/rasterstats.html#rasterstats.gen_zonal_stats">documentation</a>),
which will tell us how we can use <code class="docutils literal notranslate"><span class="pre">rasterstats</span></code> to get zonal
statistics for a raster and vector geometry:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">rasterstats</span><span class="o">.</span><span class="n">gen_zonal_stats</span><span class="p">)</span>
</pre></div>
</div>
<p>In the output of the cell above, you should see the usage for
<code class="docutils literal notranslate"><span class="pre">rasterstats.gen_zonal_stats()</span></code>, which is the same as the usage for
<code class="docutils literal notranslate"><span class="pre">rasterstats.zonal_stats()</span></code>. Have a look at the documentation - we’ll
go over an example below, but there are many more useful features that
we won’t go into in the tutorial.</p>
<p>In the following cell, we use <code class="docutils literal notranslate"><span class="pre">rasterstats.zonal_stats()</span></code>
(<a class="reference external" href="https://pythonhosted.org/rasterstats/manual.html#zonal-statistics">documentation</a>)
with our <code class="docutils literal notranslate"><span class="pre">counties</span></code> and <code class="docutils literal notranslate"><span class="pre">landcover</span></code> datasets to do the same exercise
as above (counting unique pixel values).</p>
<p>Rather than counting the pixels in the entire raster, however, we want
to count the number of pixels with each land cover value that fall
within a specific area defined by each of the features in the
<code class="docutils literal notranslate"><span class="pre">counties</span></code> dataset:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">county_stats</span> <span class="o">=</span> <span class="n">rasterstats</span><span class="o">.</span><span class="n">zonal_stats</span><span class="p">(</span><span class="n">counties</span><span class="p">,</span> <span class="c1"># the shapefile to use</span>
                                       <span class="n">landcover</span><span class="p">,</span> <span class="c1"># the raster to use - here, we&#39;re using the numpy array loaded using rasterio</span>
                                       <span class="n">affine</span><span class="o">=</span><span class="n">affine_tfm</span><span class="p">,</span> <span class="c1"># the geotransform for the raster</span>
                                       <span class="n">categorical</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># whether the data are categorical</span>
                                       <span class="n">category_map</span><span class="o">=</span><span class="n">landcover_names</span><span class="p">,</span>
                                       <span class="n">nodata</span><span class="o">=</span><span class="mi">0</span> <span class="c1"># the nodata value for the raster</span>
                                      <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">county_stats</span><span class="p">))</span> <span class="c1"># county_stats is a list of dict objects</span>
<span class="nb">print</span><span class="p">(</span><span class="n">county_stats</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># shows the landcover use for county tyrone (index 0 in counties geodataframe)</span>
</pre></div>
</div>
</div>
<div class="section" id="the-zip-built-in">
<h3>the zip built-in<a class="headerlink" href="#the-zip-built-in" title="Permalink to this heading">#</a></h3>
<p>We introduced the <code class="docutils literal notranslate"><span class="pre">zip()</span></code> built-in function above, but it’s worth
discussing this powerful and useful function in a bit more detail.</p>
<p>In Python 3, <code class="docutils literal notranslate"><span class="pre">zip()</span></code> returns a <strong>zip</strong> object that combines elements
from each of the iterable objects passed as arguments:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
<p>We have seen something similar with <strong>iterator</strong> objects before - for
example, the output of <code class="docutils literal notranslate"><span class="pre">range()</span></code> is an <strong>iterator</strong>. As we have seen,
we can <em>iterate</em> over the items of the <strong>iterator</strong> object, or we can
use something like <code class="docutils literal notranslate"><span class="pre">list()</span></code> to convert the <strong>iterator</strong> into another
type of object:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)))</span>
</pre></div>
</div>
<p>And, as we saw above, we can also pass the output of <code class="docutils literal notranslate"><span class="pre">zip()</span></code> to
<code class="docutils literal notranslate"><span class="pre">dict()</span></code>, to create a <strong>dict</strong> of <strong>key</strong>/<strong>value</strong> pairs - this is an
efficient way to create a <strong>dict</strong> object from two <strong>list</strong> objects of
different items:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)))</span>
</pre></div>
</div>
<p>One thing to keep in mind, though, is that with <code class="docutils literal notranslate"><span class="pre">zip(x,</span> <span class="pre">y)</span></code>, each of
the elements of <code class="docutils literal notranslate"><span class="pre">x</span></code> is paired with the corresponding element from
<code class="docutils literal notranslate"><span class="pre">y</span></code>. If <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> are different lengths, <code class="docutils literal notranslate"><span class="pre">zip(x,</span> <span class="pre">y)</span></code> will only
use up to the shorter of the two:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
<p>As a final example, we can also use <code class="docutils literal notranslate"><span class="pre">zip()</span></code> to combine more than two
iterables - we’re not limited to a single pair of iterables:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">]</span>
<span class="n">z</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;ii&#39;</span><span class="p">,</span> <span class="s1">&#39;iii&#39;</span><span class="p">,</span> <span class="s1">&#39;iv&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)))</span>
</pre></div>
</div>
<p>Now, let’s use <code class="docutils literal notranslate"><span class="pre">zip()</span></code> to create a <strong>dict</strong> that returns the landcover
stats for each county, given the county name.</p>
<p>First, we can use a <em>list comprehension</em> to get a list of the county
names, formatted using <code class="docutils literal notranslate"><span class="pre">str.title()</span></code>:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">counties</span><span class="p">[</span><span class="s1">&#39;CountyName&#39;</span><span class="p">]]</span> <span class="c1"># use str.title() because we&#39;re not shouting</span>
</pre></div>
</div>
<p>Now, we use <code class="docutils literal notranslate"><span class="pre">dict()</span></code> and <code class="docutils literal notranslate"><span class="pre">zip()</span></code> to create the <strong>dict</strong> object of
landcover stats by county:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">county_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">county_stats</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">county_dict</span><span class="p">[</span><span class="s1">&#39;Tyrone&#39;</span><span class="p">])</span> <span class="c1"># should be the same output as before</span>
</pre></div>
</div>
</div>
<div class="section" id="handling-exceptions-with-try-except">
<h3>handling Exceptions with try … except<a class="headerlink" href="#handling-exceptions-with-try-except" title="Permalink to this heading">#</a></h3>
<p>Now, let’s add information about the percent landcover to the
<code class="docutils literal notranslate"><span class="pre">counties</span></code> table. We’ll start by using creating a <strong>dict</strong> that takes
the full landcover class name, and shortens it so that it can be used as
a column header:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">short_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;broadleaf&#39;</span><span class="p">,</span> <span class="s1">&#39;coniferous&#39;</span><span class="p">,</span> <span class="s1">&#39;arable&#39;</span><span class="p">,</span> <span class="s1">&#39;imp_grass&#39;</span><span class="p">,</span> <span class="s1">&#39;nat_grass&#39;</span><span class="p">,</span>
               <span class="s1">&#39;mountain&#39;</span><span class="p">,</span> <span class="s1">&#39;saltwater&#39;</span><span class="p">,</span> <span class="s1">&#39;freshwater&#39;</span><span class="p">,</span> <span class="s1">&#39;coastal&#39;</span><span class="p">,</span> <span class="s1">&#39;built_up&#39;</span><span class="p">]</span>
<span class="n">short_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">landcover_names</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">short_names</span><span class="p">))</span> <span class="c1"># use dict and zip with the full names</span>
</pre></div>
</div>
<p>Now, we can use this to populate the data table with new columns for
each landcover class:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">counties</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span> <span class="c1"># use iterrows to iterate over the rows of the table</span>
    <span class="n">county_data</span> <span class="o">=</span> <span class="n">county_dict</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;CountyName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">()]</span> <span class="c1"># get the landcover data for this county</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">landcover_names</span><span class="o">.</span><span class="n">values</span><span class="p">():</span> <span class="c1"># iterate over each of the landcover class names</span>
        <span class="n">counties</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="n">short_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]]</span> <span class="o">=</span> <span class="n">county_data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="c1"># add the landcover count to a new column</span>
</pre></div>
</div>
<p>What happened here?</p>
<p>From the error message above, we can see that there is no entry for
<code class="docutils literal notranslate"><span class="pre">Saltwater</span></code> in the data for this county (Tyrone):</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;CountyName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">())</span> <span class="c1"># show the county name that caused the error</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saltwater&#39;</span> <span class="ow">in</span> <span class="n">county_dict</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;CountyName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">()]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="c1"># is Saltwater a valid key for this county?</span>
</pre></div>
</div>
<p>Because <code class="docutils literal notranslate"><span class="pre">Saltwater</span></code> is not in the list of <strong>key</strong> values for this
<strong>dict</strong>, when we try to use <code class="docutils literal notranslate"><span class="pre">Saltwater</span></code> as a <strong>key</strong> in the
<code class="docutils literal notranslate"><span class="pre">county_data</span></code> dictionary, it raises a <strong>KeyError</strong>.</p>
<p>The problem that we have here is that we don’t necessarily have all
landcover classes represented in every county. We shouldn’t expect to,
either - County Tyrone is an inland county, so it makes sense that it
wouldn’t have any saltwater areas.</p>
<p>One way to handle this could be to insert an <strong>if</strong>/<strong>else</strong> block to
check that the landcover class is present in the <strong>dict</strong> before trying
to access it. This would check whether the value of <code class="docutils literal notranslate"><span class="pre">name</span></code> is a
<strong>key</strong> of <code class="docutils literal notranslate"><span class="pre">county_data</span></code> - if it isn’t, then it will add a value of 0
to the table for that column:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">counties</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span> <span class="c1"># use iterrows to iterate over the rows of the table</span>
    <span class="n">county_data</span> <span class="o">=</span> <span class="n">county_dict</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;CountyName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">()]</span> <span class="c1"># get the landcover data for this county</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">landcover_names</span><span class="o">.</span><span class="n">values</span><span class="p">():</span> <span class="c1"># iterate over each of the landcover class names</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">county_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="c1"># check that name is a key of county_data</span>
            <span class="n">counties</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="n">short_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]]</span> <span class="o">=</span> <span class="n">county_data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="c1"># add the landcover count to a new column</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">counties</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="n">short_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># if name is not present, value should be 0.</span>
</pre></div>
</div>
<p>Another option is to use a <code class="docutils literal notranslate"><span class="pre">`try</span></code> …
<code class="docutils literal notranslate"><span class="pre">except</span></code> &lt;<a class="reference external" href="https://realpython.com/python-exceptions/#the-try-and-except-block-handling-exceptions">https://realpython.com/python-exceptions/#the-try-and-except-block-handling-exceptions</a>&gt;`__
block to “catch” and handle an exception:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="c1"># run some code</span>
<span class="k">except</span><span class="p">:</span>
    <span class="c1"># run this if the try block causes an exception</span>
</pre></div>
</div>
<p>In general, it’s <a class="reference external" href="https://www.python.org/dev/peps/pep-0008/#programming-recommendations">not
recommended</a>
to just have a bare <code class="docutils literal notranslate"><span class="pre">except:</span></code> clause, as this will make it harder to
interrupt a program. In our specific case, we only want the interpreter
to ignore <code class="docutils literal notranslate"><span class="pre">KeyError</span></code> exceptions - if there are other problems, we
still need to know about those.</p>
<p>In our example, the <code class="docutils literal notranslate"><span class="pre">try</span></code> … <code class="docutils literal notranslate"><span class="pre">except</span></code> block looks like this:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">counties</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span> <span class="c1"># use iterrows to iterate over the rows of the table</span>
    <span class="n">county_data</span> <span class="o">=</span> <span class="n">county_dict</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;CountyName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">()]</span> <span class="c1"># get the landcover data for this county</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">landcover_names</span><span class="o">.</span><span class="n">values</span><span class="p">():</span> <span class="c1"># iterate over each of the landcover class names</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">counties</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="n">short_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]]</span> <span class="o">=</span> <span class="n">county_data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="c1"># add the landcover count to a new column</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span> <span class="c1"># we can ignore KeyErrors, because this just means the landcover class has a value of 0</span>
            <span class="n">counties</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="n">short_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># if name is not present, value should be 0.</span>

<span class="n">counties</span> <span class="c1"># just to show the table in the output below</span>
</pre></div>
</div>
<p>Now, we can see that the table has had an additional 10 columns added
(one for each landcover class), with each column being filled with the
number of pixels in each county that are classified as that landcover
class.</p>
<p>As one final step, let’s update the table so that the value corresponds
to the percentage of each county’s area covered by each landcover class:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">counties</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span> <span class="c1"># iterate over the rows of the table</span>
    <span class="n">counties</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="n">short_names</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">row</span><span class="p">[</span><span class="n">short_names</span><span class="p">]</span> <span class="o">/</span> <span class="n">row</span><span class="p">[</span><span class="n">short_names</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">counties</span> <span class="c1"># just to show the table in the output below</span>
</pre></div>
</div>
<p>In the above, you can see that we’ve <em>indexed</em> the table using the list
of column names <code class="docutils literal notranslate"><span class="pre">short_name</span></code>, which ensures that we only select the
columns we’re interested in.</p>
<p>Looking at the table above, what landcover class dominates each county?
Does this make sense, given what you know about Northern Ireland?</p>
<p>As a final exercise, modify the cell below so that each cell represents
the total area (in square km) covered by each landcover class, rather
than the number of pixels or the percent area of each county.</p>
<p>As a small hint, you should only need to change a single line:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">counties</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span> <span class="c1"># use iterrows to iterate over the rows of the table</span>
    <span class="n">county_data</span> <span class="o">=</span> <span class="n">county_dict</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;CountyName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">()]</span> <span class="c1"># get the landcover data for this county</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">landcover_names</span><span class="o">.</span><span class="n">values</span><span class="p">():</span> <span class="c1"># iterate over each of the landcover class names</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">counties</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="n">short_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]]</span> <span class="o">=</span> <span class="n">county_data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="c1"># add the landcover count to a new column</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">counties</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="n">short_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># if name is not present, value should be 0.</span>

<span class="n">counties</span> <span class="c1"># just to show the table in the output below</span>
</pre></div>
</div>
</div>
<div class="section" id="rasterizing-vector-data-using-rasterio">
<h3>rasterizing vector data using rasterio<a class="headerlink" href="#rasterizing-vector-data-using-rasterio" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">rasterstats</span></code> provides a nice tool for quickly and easily extracting
zonal statistics from a raster using vector data. Sometimes, though, we
might want to <em>rasterize</em> our vector data - for example, in order to
mask our raster data, or to be able to select pixels. To do this, we can
use the <code class="docutils literal notranslate"><span class="pre">rasterio.features</span></code> module
(<a class="reference external" href="https://rasterio.readthedocs.io/en/latest/api/rasterio.features.html">documentation</a>):</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rasterio.features</span> <span class="c1"># we have imported rasterio as rio, so this will be rio.features (and rasterio.features)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">rasterio.features</span></code>has a number of different methods, but the one we
are interested in here is <code class="docutils literal notranslate"><span class="pre">rasterize()</span></code>
(<a class="reference external" href="https://rasterio.readthedocs.io/en/latest/api/rasterio.features.html#rasterio.features.rasterize">documentation</a>):</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">rio</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">rasterize</span><span class="p">)</span>
</pre></div>
</div>
<p>Here, we pass an <strong>iterable</strong> object (<strong>list</strong>, <strong>tuple</strong>, <strong>array</strong>,
etc.) that contains (<code class="docutils literal notranslate"><span class="pre">geometry</span></code>, <code class="docutils literal notranslate"><span class="pre">value</span></code>) pairs. <code class="docutils literal notranslate"><span class="pre">value</span></code>
determines the pixel values in the output raster that the <code class="docutils literal notranslate"><span class="pre">geometry</span></code>
overlaps. If we don’t provide a <code class="docutils literal notranslate"><span class="pre">value</span></code>, it takes the
<code class="docutils literal notranslate"><span class="pre">default_value</span></code> or the <code class="docutils literal notranslate"><span class="pre">fill</span></code> value.</p>
<p>So, to create a rasterized version of our county outlines, we could do
the following:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shapes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">counties</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">],</span> <span class="n">counties</span><span class="p">[</span><span class="s1">&#39;COUNTY_ID&#39;</span><span class="p">]))</span> <span class="c1"># get a list of geometry, value pairs</span>
<span class="n">county_mask</span> <span class="o">=</span> <span class="n">rio</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">rasterize</span><span class="p">(</span><span class="n">shapes</span><span class="o">=</span><span class="n">shapes</span><span class="p">,</span> <span class="c1"># the list of geometry/value pairs</span>
                                     <span class="n">fill</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="c1"># the value to use for cells not covered by any geometry</span>
                                     <span class="n">out_shape</span><span class="o">=</span><span class="n">landcover</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="c1"># the shape of the new raster</span>
                                     <span class="n">transform</span><span class="o">=</span><span class="n">affine_tfm</span><span class="p">)</span> <span class="c1"># the geotransform of the new raster</span>
</pre></div>
</div>
<p>The first line uses <code class="docutils literal notranslate"><span class="pre">zip()</span></code> and <code class="docutils literal notranslate"><span class="pre">list()</span></code> to create a list of
(<strong>geometry</strong>, <strong>value</strong>) pairs, and the second line actually creates
the rasterized array, <code class="docutils literal notranslate"><span class="pre">county_mask</span></code>.</p>
<p>Note that in the call to <code class="docutils literal notranslate"><span class="pre">rasterio.features.rasterize()</span></code>, we have to
set the output shape (<code class="docutils literal notranslate"><span class="pre">out_shape</span></code>) of the raster, as well as the
<code class="docutils literal notranslate"><span class="pre">transform</span></code> - that is, how we go from pixel coordinates in the array
to real-world coordinates.</p>
<p>Since we want to use this rasterized output with our <code class="docutils literal notranslate"><span class="pre">landcover</span></code>, we
use the <code class="docutils literal notranslate"><span class="pre">shape</span></code> of the <code class="docutils literal notranslate"><span class="pre">landcover</span></code> raster, as well as its
<code class="docutils literal notranslate"><span class="pre">transform</span></code> (<code class="docutils literal notranslate"><span class="pre">affine_tfm</span></code>) - that way, the outputs will line up as
we expect.</p>
<p>The cell below will display the <code class="docutils literal notranslate"><span class="pre">county_mask</span></code> raster in a
<code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> <strong>Figure</strong>:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">county_mask</span><span class="p">)</span> <span class="c1"># visualize the rasterized output</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">)</span> <span class="c1"># show a colorbar</span>
</pre></div>
</div>
<img alt="../../../_images/ZonalStats_53_1.png" src="../../../_images/ZonalStats_53_1.png" />
<p>As you can see, this provides us with an <strong>array</strong> whose values
correspond to the <code class="docutils literal notranslate"><span class="pre">COUNTY_ID</span></code> of the county feature at that location
(check the <code class="docutils literal notranslate"><span class="pre">counties</span></code> <strong>GeoDataFrame</strong> again to see which county
corresponds to which ID). In the next section, we’ll see how we can use
arrays like this to investigate our data further.</p>
</div>
<div class="section" id="masking-and-indexing-rasters">
<h3>masking and indexing rasters<a class="headerlink" href="#masking-and-indexing-rasters" title="Permalink to this heading">#</a></h3>
<p>So far, we’ve seen how we can index an array (or a list, a tuple, …)
using simple indexing (e.g., <code class="docutils literal notranslate"><span class="pre">myList[0]</span></code>) or <em>slicing</em> (e.g.,
<code class="docutils literal notranslate"><span class="pre">myList[2:4]</span></code>). <code class="docutils literal notranslate"><span class="pre">numpy</span></code> arrays, however, can <a class="reference external" href="https://numpy.org/doc/stable/reference/arrays.indexing.html">actually be
indexed</a>
using other arrays of type <code class="docutils literal notranslate"><span class="pre">bool</span></code> (the elements of the array are
boolean (<code class="docutils literal notranslate"><span class="pre">True</span></code>/<code class="docutils literal notranslate"><span class="pre">False</span></code>) values) - similar to how we have used
conditional statements to select rows from a <strong>GeoDataFrame</strong>.</p>
<p>In this section, we’ll see how we can use this, along with our
rasterized vectors, to select and investigate values from a raster using
boolean indexing.</p>
<p>To start, we’ll open our dem raster - note that this raster has the same
georeferencing information as our landcover raster, so we don’t have to
load all of that information, just the raster band:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">rio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;data_files/NI_DEM.tif&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dataset</span><span class="p">:</span>
    <span class="n">dem</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>From the previous section, we have an array with values corresponding
each of the counties of Northern Ireland. Using <code class="docutils literal notranslate"><span class="pre">numpy</span></code>, we can use
this array to select elements of other rasters by creating a <em>mask</em>, or
a boolean array - that is, an array with values of <code class="docutils literal notranslate"><span class="pre">True</span></code> and
<code class="docutils literal notranslate"><span class="pre">False</span></code>. For example, we can create a mask corresponding to County
Antrim (<code class="docutils literal notranslate"><span class="pre">COUNTY_ID=1</span></code>) like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">county_antrim</span> <span class="o">=</span> <span class="n">county_mask</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Let’s see what this mask looks like:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">county_antrim</span> <span class="o">=</span> <span class="n">county_mask</span> <span class="o">==</span> <span class="mi">1</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">county_antrim</span><span class="p">)</span> <span class="c1"># visualize the rasterized output</span>
</pre></div>
</div>
<img alt="../../../_images/ZonalStats_57_1.png" src="../../../_images/ZonalStats_57_1.png" />
<p>We can also combine expressions using functions like
<code class="docutils literal notranslate"><span class="pre">`np.logical_and()</span></code> &lt;<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.logical_and.html">https://numpy.org/doc/stable/reference/generated/numpy.logical_and.html</a>&gt;`__
or
<code class="docutils literal notranslate"><span class="pre">`np.logical_or()</span></code> &lt;<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.logical_or.html">https://numpy.org/doc/stable/reference/generated/numpy.logical_or.html</a>&gt;`__.
If we wanted to create a mask corresponding to both County Antrim
(<code class="docutils literal notranslate"><span class="pre">county_mask</span> <span class="pre">==</span> <span class="pre">3</span></code>) and County Down (<code class="docutils literal notranslate"><span class="pre">county_mask</span> <span class="pre">==</span> <span class="pre">1</span></code>), we could
do the following:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">antrim_and_down</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">county_mask</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="n">county_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">antrim_and_down</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../../_images/ZonalStats_59_1.png" src="../../../_images/ZonalStats_59_1.png" />
<p>We could then find the mean elevation of these two counties by indexing,
or selecting, pixels from <code class="docutils literal notranslate"><span class="pre">dem</span></code> using our mask:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ad_elevation</span> <span class="o">=</span> <span class="n">dem</span><span class="p">[</span><span class="n">antrim_and_down</span><span class="p">]</span> <span class="c1"># index the array using the antrim_and_down mask</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean elevation: </span><span class="si">{:.2f}</span><span class="s1"> m&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ad_elevation</span><span class="o">.</span><span class="n">mean</span><span class="p">()))</span>
</pre></div>
</div>
<p>Now let’s say we wanted to investigate the two types of woodland we
have, broadleaf and conifer. One thing we might want to look at is the
area-elevation distribution of each type. To do this, we first have to
select the pixels from the DEM that correspond to the broadleaf
woodlands, and all of the pixels corresponding to conifer woodlands:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">broad_els</span> <span class="o">=</span> <span class="n">dem</span><span class="p">[</span><span class="n">landcover</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="c1"># get all dem values where landcover = 1</span>
<span class="n">conif_els</span> <span class="o">=</span> <span class="n">dem</span><span class="p">[</span><span class="n">landcover</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span> <span class="c1"># get all dem values where landcover = 2</span>
</pre></div>
</div>
<p>Now, we have two different arrays, <code class="docutils literal notranslate"><span class="pre">broad_els</span></code> and <code class="docutils literal notranslate"><span class="pre">conif_els</span></code>, each
corresponding to the DEM pixel values of each landcover type. We can
plot a histogram of these arrays using <code class="docutils literal notranslate"><span class="pre">plt.hist()</span></code>
(<a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.hist.html">documentation</a>),
but this will only tell us the number of pixels - to work with areas,
remember that we have to convert the pixel counts into areas by
multiplying with the pixel area (here, 100 m x 100 m).</p>
<p>First, though, we can use <code class="docutils literal notranslate"><span class="pre">numpy.histogram()</span></code>
(<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.histogram.html">documentation</a>),
along with an <strong>array</strong> representing our elevation bins, to produce a
count of the number of pixels with an elevation that falls within each
bin. We’ll use <code class="docutils literal notranslate"><span class="pre">numpy.arange()</span></code>
(<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.arange.html">documentation</a>)
to generate an <strong>array</strong> of elevation bins ranging from 0 to 600 meters,
spaced by 5 meters:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">el_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="c1"># create an array of values ranging from 0 to 600, spaced by 5.</span>

<span class="n">broad_count</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">broad_els</span><span class="p">,</span> <span class="n">el_bins</span><span class="p">)</span> <span class="c1"># bin the broadleaf elevations using the elevation bins</span>
<span class="n">conif_count</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">conif_els</span><span class="p">,</span> <span class="n">el_bins</span><span class="p">)</span> <span class="c1"># bin the conifer elevations using the elevation bins</span>

<span class="n">broad_area</span> <span class="o">=</span> <span class="n">broad_count</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">*</span> <span class="mi">100</span> <span class="c1"># convert the pixel counts to an area by multipling by the pixel size in x, y</span>
<span class="n">conif_area</span> <span class="o">=</span> <span class="n">conif_count</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">*</span> <span class="mi">100</span>
</pre></div>
</div>
<p>Finally, we can plot the area-elevation distribution for each land cover
type using <code class="docutils literal notranslate"><span class="pre">plt.bar()</span></code>
(<a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.bar.html">documentation</a>):</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span> <span class="c1"># create a new figure and axes object</span>

<span class="c1"># plot the area-elevation distributions using matplotlib.pyplot.bar(), converting from sq m to sq km:</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">el_bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">broad_area</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;edge&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Broadleaf Woodland&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">el_bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">conif_area</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;edge&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Conifer Woodland&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">550</span><span class="p">)</span> <span class="c1"># set the x limits of the plot</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span> <span class="c1"># set the y limits of the plot</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Elevation (m)&#39;</span><span class="p">)</span> <span class="c1"># add an x label</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Area (km$^2$)&#39;</span><span class="p">)</span> <span class="c1"># add a y label</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span> <span class="c1"># add a legend</span>
</pre></div>
</div>
<img alt="../../../_images/ZonalStats_67_1.png" src="../../../_images/ZonalStats_67_1.png" />
<p>From this, we can clearly see that Conifer woodlands tend to be found at
much higher elevations than Broadleaf woodlands, and at a much larger
range of elevations (0-500 m, compared to 0-250 m or so).</p>
<p>With these samples (<code class="docutils literal notranslate"><span class="pre">broad_els</span></code>, <code class="docutils literal notranslate"><span class="pre">conif_els</span></code>), we can also calculate
statistics for each of these samples using <code class="docutils literal notranslate"><span class="pre">numpy</span></code> functions such as
<code class="docutils literal notranslate"><span class="pre">np.mean()</span></code>
(<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.mean.html">documentation</a>),
<code class="docutils literal notranslate"><span class="pre">np.median()</span></code>
(<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.median.html">documentation</a>),
<code class="docutils literal notranslate"><span class="pre">np.std()</span></code>
(<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.std.html">documentation</a>),
and so on:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Broadleaf mean elevation: </span><span class="si">{:.2f}</span><span class="s1"> m&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">broad_els</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Broadleaf median elevation: </span><span class="si">{:.2f}</span><span class="s1"> m&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">broad_els</span><span class="p">)))</span>
</pre></div>
</div>
<p>Of the 10 different landcover types shown here, which one has the
highest mean elevation? What about the largest spread in elevation
values?</p>
<p>Starting from the initial code in the cell below, create a <strong>DataFrame</strong>
of descriptive statistics of the elevation for each landcover type,
which will help you answer this question.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a new pandas DataFrame with 6 columns</span>
<span class="n">landcover_els</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;median&#39;</span><span class="p">,</span> <span class="s1">&#39;std. dev&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;range&#39;</span><span class="p">])</span>

<span class="n">landcover_els</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">short_names</span> <span class="c1"># add the short names to the &#39;name&#39; column</span>

<span class="c1"># now, write a loop that will populate the table with descriptive statistics about the elevation</span>
<span class="c1"># of each landcover class</span>
</pre></div>
</div>
</div>
<div class="section" id="next-steps">
<h3>Next steps<a class="headerlink" href="#next-steps" title="Permalink to this heading">#</a></h3>
<p>That’s all for this practical. In lieu of an additional exercise this
week, spend some time working on your project - are there concepts or
examples from this practical that you can incorporate into your project?</p>
<div class="section" id="footnotes">
<h4>Footnotes<a class="headerlink" href="#footnotes" title="Permalink to this heading">#</a></h4>
<p><a class="reference external" href="#fn1-back">1</a>Rowland, C.S.; Morton, R.D.; Carrasco, L.; McShane,
G.; O’Neil, A.W.; Wood, C.M. (2017). Land Cover Map 2015 (25m raster, N.
Ireland). NERC Environmental Information Data Centre.
<a class="reference external" href="https://doi.org/10.5285/47f053a0-e34f-4534-a843-76f0a0998a2f">doi:10.5285/47f053a0-e34f-4534-a843-76f0a0998a2f</a></p>
</div>
</div>
</div>
</div>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="earthaccess.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">searching + downloading satellite data using earthaccess</p>
      </div>
    </a>
    <a class="right-next"
       href="../faq/index.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">help! something went wrong!</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-started">getting started</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nick-cassavetes">Nick Cassavetes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">overview</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#objectives">objectives</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-provided">data provided</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">getting started</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#zonal-statistics">zonal statistics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-zip-built-in">the zip built-in</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#handling-exceptions-with-try-except">handling Exceptions with try … except</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rasterizing-vector-data-using-rasterio">rasterizing vector data using rasterio</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#masking-and-indexing-rasters">masking and indexing rasters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next steps</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#footnotes">Footnotes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Bob McNabb
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2024, Bob McNabb. Licensed under Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0).
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=ac02cc09edc035673794"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>