<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>week 1 - dem processing using micmac &mdash; iamdonovan  documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="week 2 - dem differencing" href="week2.html" />
    <link rel="prev" title="software setup" href="setup.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> iamdonovan
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../whataboutbob.html">about me</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">teaching and related resources</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../index.html#unis-spring-2017">unis (spring 2017)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../index.html#esa-cryosphere-training-course-june-2018">esa cryosphere training course (june 2018)</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html#ulster-2020-present">ulster (2020-present)</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../egm310/index.html">EGM310: introduction to gis and remote sensing</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">EGM702: photogrammetry and advanced image analysis</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../lectures.html">lectures</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="index.html">practicals</a></li>
<li class="toctree-l4"><a class="reference internal" href="../resources.html">additional resources</a></li>
<li class="toctree-l4"><a class="reference internal" href="../index.html#content">content</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../egm703/index.html">EGM703: advanced active and passive remote sensing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../egm722/index.html">EGM722: programming for gis and remote sensing</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../research/index.html">ongoing and past research projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../github.html">github projects</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">iamdonovan</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">teaching and related resources</a> &raquo;</li>
          <li><a href="../index.html">EGM702: photogrammetry and advanced image analysis</a> &raquo;</li>
          <li><a href="index.html">practicals</a> &raquo;</li>
      <li>week 1 - dem processing using micmac</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/teaching/egm702/practicals/week1.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="week-1-dem-processing-using-micmac">
<h1>week 1 - dem processing using micmac<a class="headerlink" href="#week-1-dem-processing-using-micmac" title="Permalink to this headline"></a></h1>
<div class="section" id="introduction">
<h2>introduction<a class="headerlink" href="#introduction" title="Permalink to this headline"></a></h2>
<p><strong>Be sure to download all the data from the Practical 1 area on Blackboard before starting, or from the</strong> <a class="reference external" href="https://drive.google.com/uc?id=1rwu32Wms_jvrmzkMRckD8kwcgl98qn4k&amp;export=download">google drive link</a><strong>, then extract the zip file. You should
have the following files/folders available:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>├─ AR5840034159994.tif
├─ AR5840034159995.tif
├─ AR5840034159996.tif
├─ AR5840034159997.tif
├─ AR5840034159998.tif
├─ AR5840034159999.tif
├─ filtre.tif
├─ id_fiducial.txt
├─ id_gcps.txt
├─ GCPs.txt
├─ MicMac-LocalChantierDescripteur.xml
├─ NAIP_Images/
└─ Ori-InterneScan/
    └─ MeasuresCamera.xml
</pre></div>
</div>
<p>In this practical, we’re going to work on processing a digital elevation model (DEM) and orthophotos using a collection of aerial photos acquired in 1984 over Mt St Helens, a volcano in Washington state, USA. During the 1980s and early 1990s, the volcano erupted several times, including an eruption in May 1980 that collapsed the entire north face of the mountain.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The instructions/images below assume that you are using MicMac in a Windows environment; the commands will be the same for a MacOS/Linux environment, but you’ll need to open
a terminal rather than the Windows command prompt.</p>
</div>
</div>
<div class="section" id="getting-started">
<h2>getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline"></a></h2>
<p>To get started, open the Windows command prompt, either by using the search bar, or <strong>Start</strong> &gt; <strong>Windows System</strong> &gt; <strong>Command Prompt</strong>.</p>
<p>To change folders from the command line, you will use the <cite>cd</cite> command. When you open the command prompt, you should be in your <strong>home</strong> folder (for me, this is <strong>C:\Users\bob</strong>). At the command prompt, navigate to the folder where you have saved the data above (for me, this is <strong>C:\Data\MtStHelens</strong>) by typing <cite>cd</cite> followed by the directory name (<strong>note the space between the command and the directory</strong>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">bob</span><span class="o">&gt;</span><span class="n">cd</span> <span class="s2">&quot;C:\Data\MtStHelens</span><span class="se">\&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the line above, <code class="docutils literal notranslate"><span class="pre">C:\Users\bob</span></code> is the current directory, and <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> is the command prompt - if you want to copy/paste the above command, be sure to copy the text <em>after</em> the <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> (i.e., <code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">C:\Data\MtStHelens</span></code>).</p>
<p>For the remaining commands, I will omit the command prompt and only write the command that you will need to use.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you have saved your data to another drive (e.g., <code class="docutils literal notranslate"><span class="pre">D:</span></code>), you will first need to change to the correct drive, <strong>before</strong> you try to change directories. So, if your data are saved to <code class="docutils literal notranslate"><span class="pre">D:\EGM702\Data</span></code>, you will need to first change drives by entering <strong>just</strong> the drive name followed by a colon:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">D</span><span class="p">:</span>
<span class="o">&gt;</span> <span class="n">cd</span> <span class="n">EGM702</span>\<span class="n">Data</span>
</pre></div>
</div>
<p>in order to change to the correct directory. Note that you’ll need to do this each time you open the command prompt - the default starting disk is <code class="docutils literal notranslate"><span class="pre">C:</span></code>.</p>
</div>
<p>To see the contents of the directory, use the <code class="docutils literal notranslate"><span class="pre">dir</span></code> command. You should see something similar to the picture below:</p>
<a class="reference internal image-reference" href="../../../_images/dir_output.png"><img alt="the outputs of the dir command" class="align-center" src="../../../_images/dir_output.png" style="width: 600px;" /></a>
<p>We’re going to run each of the processing steps in MicMac using the command line interface. If you are curious about what a particular command or input parameter does, you can always type <code class="docutils literal notranslate"><span class="pre">-help</span></code> after the command, and information about how to use the command will be printed to the screen. For example, for the first command we will use, you can type the following at the command prompt:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mm3d</span> <span class="n">SaisieAppuisInitQt</span> <span class="o">-</span><span class="n">help</span>
</pre></div>
</div>
<p>This will open the following window:</p>
<a class="reference internal image-reference" href="../../../_images/saisie_help.png"><img alt="the saisieappuis help window" class="align-center" src="../../../_images/saisie_help.png" style="width: 400px;" /></a>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In a MacOS/linux environment, the help message may just display to the terminal window, rather than opening a popup window.</p>
</div>
<p>The help text shows you the arguments that you have to use to run the command, as well as optional named arguments and their meanings. For other commands, such as <code class="docutils literal notranslate"><span class="pre">Malt</span></code>, the text will print directly to the command window.</p>
</div>
<div class="section" id="resampling-the-images">
<h2>resampling the images<a class="headerlink" href="#resampling-the-images" title="Permalink to this headline"></a></h2>
<p>The first thing we have to do is make sure the images are re-sampled to a consistent geometry. To do this in MicMac, we use the <code class="docutils literal notranslate"><span class="pre">SaisieAppuisInitQT</span></code> command. We’ll start with the first image, <strong>AR5840034159994.tif</strong>. To begin, type the following (or copy &amp; paste) at the command prompt (note the lack of space in <strong>MeasuresIm-AR5840034159994.tif.xml</strong>). You may also have to re-type the quotation marks, as the command prompt may not recognize them:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mm3d</span> <span class="n">SaisieAppuisInitQT</span> <span class="s2">&quot;AR5840034159994.tif&quot;</span> <span class="n">NONE</span> <span class="n">id_fiducial</span><span class="o">.</span><span class="n">txt</span> <span class="n">MeasuresIm</span><span class="o">-</span><span class="n">AR5840034159994</span><span class="o">.</span><span class="n">tif</span><span class="o">.</span><span class="n">xml</span>
</pre></div>
</div>
<p>This will open the window shown below:</p>
<a class="reference internal image-reference" href="../../../_images/saisie_fid.png"><img alt="the saisie window" class="align-center" src="../../../_images/saisie_fid.png" style="width: 600px;" /></a>
<p>You’ll need to set the locations of each of the fiducial marks in the image (there are 8 in total). They are numbered as you can see in the image above, with <strong>P1</strong> located in the lower left corner of the image. You can pan around the viewer by pressing the centre wheel on your mouse, or zoom in/out using the scroll wheel on your mouse. Zoom in on the <strong>P1</strong> mark, then click on <strong>P1</strong> in the table on the right side of the frame, and finally click on the dot in the centre of the fiducial mark:</p>
<a class="reference internal image-reference" href="../../../_images/fiducial.png"><img alt="a fiducial marker" class="align-center" src="../../../_images/fiducial.png" style="width: 200px;" /></a>
<p>You want to get as close to the middle of the dot as possible. You might notice that this isn’t easy for <strong>P6</strong>, which is partly obscured - just do the best that you can. When you’re satisfied you have the right point, continue for the remainder of the points, then select <strong>File</strong> &gt; <strong>Exit</strong>.</p>
<p>To input the points for the next image (<strong>AR5840034159995.tif</strong>), you’ll need to change both the input filename and the output filename in the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mm3d</span> <span class="n">SaisieAppuisInitQT</span> <span class="s2">&quot;AR5840034159995.tif&quot;</span> <span class="n">NONE</span> <span class="n">id_fiducial</span><span class="o">.</span><span class="n">txt</span> <span class="n">MeasuresIm</span><span class="o">-</span><span class="n">AR5840034159995</span><span class="o">.</span><span class="n">tif</span><span class="o">.</span><span class="n">xml</span>
</pre></div>
</div>
<p>Once that’s done, repeat this for the remaining images in the directory. You’ll notice that micmac has created two MeasuresIm files for each image, one with an extension <strong>-S2D.xml</strong>, and the other with an extension <strong>-S3D.xml</strong>. You’ll need to move each of the <strong>S2D.xml</strong> files:</p>
<ul class="simple">
<li><p>MeasuresIm-AR5840034159994.tif-S2D.xml</p></li>
<li><p>MeasuresIm-AR5840034159995.tif-S2D.xml</p></li>
<li><p>MeasuresIm-AR5840034159996.tif-S2D.xml</p></li>
<li><p>MeasuresIm-AR5840034159997.tif-S2D.xml</p></li>
<li><p>MeasuresIm-AR5840034159998.tif-S2D.xml</p></li>
<li><p>MeasuresIm-AR5840034159999.tif-S2D.xml</p></li>
</ul>
<p>into the <strong>Ori-InterneScan</strong> directory, being sure to remove the <strong>-S2D</strong> from each name. <strong>Ori-InterneScan/</strong> should now
look like this:</p>
<a class="reference internal image-reference" href="../../../_images/ori-internescan_dir.png"><img alt="the contents of the ori-internescan directory" class="align-center" src="../../../_images/ori-internescan_dir.png" style="width: 600px;" /></a>
<p>At this point, you can delete the <strong>S3D</strong> files – the program creates them, but we don’t actually need them. Next up, re-sample the images using the fiducial marks you have identified, so that each image has the same geometry:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mm3d</span> <span class="n">ReSampFid</span> <span class="s2">&quot;AR.*tif&quot;</span> <span class="mf">0.05</span>
</pre></div>
</div>
<p>This will re-sample each of the images to a resolution of 50 microns (i.e., 1 pixel = 0.05 mm). If you’re worried about space, you can re-sample to 100 microns if need be (change 0.05 to 0.1 in the command above). Note that this will lower the final resolution of your DEM and orthophoto, though, from about 4 metres to 8 metres.</p>
<p>If the command runs correctly, you should see the names of each image printed out, along with the residuals (in # of pixels) and the amount of time it took to re-sample each image.</p>
<p>As long as the residuals are small (&lt;2 pixels or so), you can continue. If not, you’ll need to adjust your fiducial mark selection, and run <code class="docutils literal notranslate"><span class="pre">ReSampFid</span></code> again. When you have successfully re-sampled the images, create a new directory called <strong>OrigImg</strong> and move the original image files into it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">OrigImg</span>
<span class="n">move</span> <span class="n">AR</span><span class="o">*.</span><span class="n">tif</span> <span class="n">OrigImg</span>
</pre></div>
</div>
<p>Note that the wildcard, or asterisk (*), symbol tells the computer to move anything that matches the pattern <code class="docutils literal notranslate"><span class="pre">AR(something).tif</span></code> into the directory <strong>OrigImg</strong> – so it should move all of the scanned images.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When running <code class="docutils literal notranslate"><span class="pre">ReSampFid</span></code>, you might get an error message like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#####  Name-TAG = MesureAppuiFlottant1Im Nb= 2</span>
<span class="o">------------------------------------------------------------</span>
<span class="o">|</span>   <span class="n">Sorry</span><span class="p">,</span> <span class="n">the</span> <span class="n">following</span> <span class="n">FATAL</span> <span class="n">ERROR</span> <span class="n">happened</span>
<span class="o">|</span>
<span class="o">|</span>    <span class="n">cElXMLTree</span><span class="p">::</span><span class="n">GetUnique</span>
<span class="o">|</span>
<span class="o">--------------------------------------------------------</span>
</pre></div>
</div>
<p>This indicates that you have defined the image points for an image in more than one file, and it most often happens when you accidentally re-use the ouput filename for multiple <code class="docutils literal notranslate"><span class="pre">SaisieAppuisInitQT</span></code> commands, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mm3d</span> <span class="n">SaisieAppuisInitQT</span> <span class="s2">&quot;AR5840034159994.tif&quot;</span> <span class="n">NONE</span> <span class="n">id_fiducial</span><span class="o">.</span><span class="n">txt</span> <span class="n">MeasuresIm</span><span class="o">-</span><span class="n">AR5840034159994</span><span class="o">.</span><span class="n">tif</span><span class="o">.</span><span class="n">xml</span>
<span class="n">mm3d</span> <span class="n">SaisieAppuisInitQT</span> <span class="s2">&quot;AR5840034159995.tif&quot;</span> <span class="n">NONE</span> <span class="n">id_fiducial</span><span class="o">.</span><span class="n">txt</span> <span class="n">MeasuresIm</span><span class="o">-</span><span class="n">AR5840034159994</span><span class="o">.</span><span class="n">tif</span><span class="o">.</span><span class="n">xml</span>
</pre></div>
</div>
<p>To fix this, you’ll need to go through each MeasuresIm file and ensure that there is only one set of <code class="docutils literal notranslate"><span class="pre">&lt;NameIm&gt;</span></code> tags, and that the image named within the tag matches the MeasuresIm filename (i.e., check that you only have <code class="docutils literal notranslate"><span class="pre">&lt;NamePt&gt;AR5840034159994.tif&lt;/NamePt&gt;</span></code> in <strong>MeasuresIm-AR5840034159994.tif.xml</strong>, <code class="docutils literal notranslate"><span class="pre">&lt;NamePt&gt;AR5840034159995.tif&lt;/NamePt&gt;</span></code> in <strong>MeasuresIm-AR5840034159995.tif.xml</strong>, and so on.</p>
</div>
</div>
<div class="section" id="computing-the-relative-orientation">
<h2>computing the relative orientation<a class="headerlink" href="#computing-the-relative-orientation" title="Permalink to this headline"></a></h2>
<p>The next step is to find tie points to help compute the relative orientation of the images. First, run <code class="docutils literal notranslate"><span class="pre">Tapioca</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mm3d</span> <span class="n">Tapioca</span> <span class="n">MulScale</span> <span class="s2">&quot;OIS.*tif&quot;</span> <span class="mi">400</span> <span class="mi">1200</span>
</pre></div>
</div>
<p>This will compute tie points at two resolutions to help speed things up. Once this completes, you can filter the tie points, to make sure that they don’t include things like the fiducial marks or any writing on the image frame:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mm3d</span> <span class="n">HomolFilterMasq</span> <span class="s2">&quot;OIS.*tif&quot;</span> <span class="n">GlobalMasq</span><span class="o">=</span><span class="n">filtre</span><span class="o">.</span><span class="n">tif</span>
</pre></div>
</div>
<p>If the provided <strong>filtre.tif</strong> doesn’t work, you can watch the video <a class="reference external" href="https://youtu.be/xOHEkKiiRnM">here</a> to make your own.</p>
<p>After this, you can compute the relative orientation using <code class="docutils literal notranslate"><span class="pre">Tapas</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mm3d</span> <span class="n">Tapas</span> <span class="n">RadialBasic</span> <span class="s2">&quot;OIS.*tif&quot;</span> <span class="n">Out</span><span class="o">=</span><span class="n">Relative</span> <span class="n">SH</span><span class="o">=</span><span class="n">HomolMasqFiltered</span> <span class="n">LibFoc</span><span class="o">=</span><span class="mi">0</span>
</pre></div>
</div>
<p>For these images, the estimated focal length is 302.26 mm, based on the value recorded by the camera at the time of acquisition. At this stage, we will keep the focal length fixed (<code class="docutils literal notranslate"><span class="pre">LibFoc=0</span></code>) to this value (which is stored in <strong>MicMac-LocalChantierDescripteur.xml</strong>). This will calibrate the relative orientation using a basic radial distortion camera model (<code class="docutils literal notranslate"><span class="pre">RadialBasic</span></code>). If you continue to use MicMac for your own projects, you might need to change the camera model used – you can check out the <a class="reference external" href="https://micmac.ensg.eu/index.php/Accueil">MicMac Wiki</a> to see the other camera models available.</p>
<p>Tapas is run iteratively, meaning that it will go through several steps before finishing the calculation. The output should look something like this (note that you may need to scroll up a bit):</p>
<img alt="../../../_images/tapas.png" src="../../../_images/tapas.png" />
<p>To explain what this means, we’ll look at this block of text:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RES</span><span class="p">:[</span><span class="n">OIS</span><span class="o">-</span><span class="n">Reech_AR5840034159994</span><span class="o">.</span><span class="n">tif</span><span class="p">][</span><span class="n">C</span><span class="p">]</span> <span class="n">ER2</span> <span class="mf">0.652321</span> <span class="n">Nn</span> <span class="mf">99.7638</span> <span class="n">Of</span> <span class="mi">2963</span> <span class="n">Mul</span> <span class="mi">334</span> <span class="n">Mul</span><span class="o">-</span><span class="n">NN</span> <span class="mi">334</span> <span class="n">Time</span> <span class="mf">0.0829999</span>
<span class="n">RES</span><span class="p">:[</span><span class="n">OIS</span><span class="o">-</span><span class="n">Reech_AR5840034159995</span><span class="o">.</span><span class="n">tif</span><span class="p">][</span><span class="n">C</span><span class="p">]</span> <span class="n">ER2</span> <span class="mf">0.693844</span> <span class="n">Nn</span> <span class="mf">99.6733</span> <span class="n">Of</span> <span class="mi">6121</span> <span class="n">Mul</span> <span class="mi">1910</span> <span class="n">Mul</span><span class="o">-</span><span class="n">NN</span> <span class="mi">1907</span> <span class="n">Time</span> <span class="mf">0.182</span>
<span class="n">RES</span><span class="p">:[</span><span class="n">OIS</span><span class="o">-</span><span class="n">Reech_AR5840034159996</span><span class="o">.</span><span class="n">tif</span><span class="p">][</span><span class="n">C</span><span class="p">]</span> <span class="n">ER2</span> <span class="mf">0.648174</span> <span class="n">Nn</span> <span class="mf">99.6889</span> <span class="n">Of</span> <span class="mi">11895</span> <span class="n">Mul</span> <span class="mi">5307</span> <span class="n">Mul</span><span class="o">-</span><span class="n">NN</span> <span class="mi">5297</span> <span class="n">Time</span> <span class="mf">0.377</span>
<span class="n">RES</span><span class="p">:[</span><span class="n">OIS</span><span class="o">-</span><span class="n">Reech_AR5840034159997</span><span class="o">.</span><span class="n">tif</span><span class="p">][</span><span class="n">C</span><span class="p">]</span> <span class="n">ER2</span> <span class="mf">0.659886</span> <span class="n">Nn</span> <span class="mf">99.7007</span> <span class="n">Of</span> <span class="mi">12696</span> <span class="n">Mul</span> <span class="mi">5826</span> <span class="n">Mul</span><span class="o">-</span><span class="n">NN</span> <span class="mi">5814</span> <span class="n">Time</span> <span class="mf">0.399</span>
<span class="n">RES</span><span class="p">:[</span><span class="n">OIS</span><span class="o">-</span><span class="n">Reech_AR5840034159998</span><span class="o">.</span><span class="n">tif</span><span class="p">][</span><span class="n">C</span><span class="p">]</span> <span class="n">ER2</span> <span class="mf">0.677032</span> <span class="n">Nn</span> <span class="mf">99.7247</span> <span class="n">Of</span> <span class="mi">10897</span> <span class="n">Mul</span> <span class="mi">4329</span> <span class="n">Mul</span><span class="o">-</span><span class="n">NN</span> <span class="mi">4320</span> <span class="n">Time</span> <span class="mf">0.333</span>
<span class="n">RES</span><span class="p">:[</span><span class="n">OIS</span><span class="o">-</span><span class="n">Reech_AR5840034159999</span><span class="o">.</span><span class="n">tif</span><span class="p">][</span><span class="n">C</span><span class="p">]</span> <span class="n">ER2</span> <span class="mf">0.697072</span> <span class="n">Nn</span> <span class="mf">99.7558</span> <span class="n">Of</span> <span class="mi">4914</span> <span class="n">Mul</span> <span class="mi">929</span> <span class="n">Mul</span><span class="o">-</span><span class="n">NN</span> <span class="mi">927</span> <span class="n">Time</span> <span class="mf">0.14</span>
</pre></div>
</div>
<p>This shows the total residual (in pixels) for all of the tie points found in each image, excluding outliers (<strong>ER2</strong>), as well as the percentage of tie points out of the total number of tie points in each image (<strong>Nn XX of XX</strong>) that were correct within the maximum acceptable error before a point is considered an outlier. It also shows how many points are seen in &gt; 2 images (<strong>Mul</strong>), and the number of points that were properly located (<strong>Mul-NN</strong>), as well as the time it took to do the calculation.</p>
<p>Below that, we see information about the set of images as a whole:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-----</span> <span class="n">Stat</span> <span class="n">on</span> <span class="nb">type</span> <span class="n">of</span> <span class="n">point</span> <span class="p">(</span><span class="n">ok</span><span class="o">/</span><span class="n">elim</span><span class="p">)</span> <span class="o">----</span>
     <span class="o">*</span>   <span class="n">Perc</span><span class="o">=</span><span class="mf">99.709</span><span class="o">%</span> <span class="p">;</span>  <span class="n">Nb</span><span class="o">=</span><span class="mi">49342</span> <span class="k">for</span> <span class="n">Ok</span>
     <span class="o">*</span>   <span class="n">Perc</span><span class="o">=</span><span class="mf">0.290991</span><span class="o">%</span> <span class="p">;</span>  <span class="n">Nb</span><span class="o">=</span><span class="mi">144</span> <span class="k">for</span> <span class="n">PdsResNull</span>
<span class="o">---------------------------------------</span>
<span class="o">|</span> <span class="o">|</span>  <span class="n">Residual</span> <span class="o">=</span> <span class="mf">0.671665</span> <span class="p">;;</span> <span class="n">Evol</span><span class="p">,</span> <span class="n">Moy</span><span class="o">=</span><span class="mf">4.31328e-08</span> <span class="p">,</span><span class="n">Max</span><span class="o">=</span><span class="mf">5.30388e-08</span>
<span class="o">|</span> <span class="o">|</span>  <span class="n">Worst</span><span class="p">,</span> <span class="n">Res</span> <span class="mf">0.697072</span> <span class="k">for</span> <span class="n">OIS</span><span class="o">-</span><span class="n">Reech_AR5840034159999</span><span class="o">.</span><span class="n">tif</span><span class="p">,</span>  <span class="n">Perc</span> <span class="mf">99.6733</span> <span class="k">for</span> <span class="n">OIS</span><span class="o">-</span><span class="n">Reech_AR5840034159995</span><span class="o">.</span><span class="n">tif</span>
<span class="o">|</span> <span class="o">|</span>  <span class="n">Cond</span> <span class="p">,</span> <span class="n">Aver</span> <span class="mf">9.23336</span> <span class="n">Max</span> <span class="mf">58.0925</span> <span class="n">Prop</span><span class="o">&gt;</span><span class="mi">100</span> <span class="mi">0</span>
</pre></div>
</div>
<p>This says that 99.709% of all tie points (49342 points) were “Ok” - that is, using the calibrated camera model and orientation, the location of each point agreed with the predicted location within the maximum allowed error. Only 0.290991% of points (140 points) had an invalid residual.</p>
<p>Below this, we see the total residual for all points in all images was 0.671665 - this indicates that the cameras are generally well-calibrated, and the images are well-placed. If the residual is very high, you might need to re-do the earlier steps of placing the fiducial markers, resampling the images, and finding the tie points.</p>
<p>You can also see that the “Worst” residual was 0.697072 for image <strong>OIS-Reech_AR5840034159999.tif</strong> - if the residual for an individual image is high, this is a hint as to which image might need to be re-done.</p>
<p>Now, let’s visualize the relative orientation using <code class="docutils literal notranslate"><span class="pre">AperiCloud</span></code> and <strong>MeshLab</strong> (or <strong>CloudCompare</strong>). First, run this command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mm3d</span> <span class="n">AperiCloud</span> <span class="s2">&quot;OIS.*tif&quot;</span> <span class="n">Relative</span> <span class="n">SH</span><span class="o">=</span><span class="n">HomolMasqFiltered</span>
</pre></div>
</div>
<p>When this completes, you should have a file called <strong>AperiCloud_Relative_MasqFiltered.ply</strong> in your directory. Open either <strong>MeshLab</strong> or <strong>CloudCompare</strong>, and then open this file. You should see something like this:</p>
<a class="reference internal image-reference" href="../../../_images/meshlab.jpg"><img alt="the relative orientation displayed in meshlab" class="align-center" src="../../../_images/meshlab.jpg" style="width: 600px;" /></a>
<p>Each of the cameras is shown as a green and red box, and the tie points are displayed as black and white pixels. As long as you can see six cameras and the basic shape of a volcano, you can close <strong>MeshLab</strong> or <strong>CloudCompare</strong>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you encounter errors along the way, you can e-mail me, or try searching google for potential resolutions. Be warned that a number of the results, as well as the error messages, may be in French. There is also a forum and a <a class="reference external" href="https://reddit.com/r/micmac">subreddit</a> where you can ask the developers and other users for help - most people are quite helpful and happy to help.</p>
</div>
</div>
<div class="section" id="computing-the-absolute-orientation">
<h2>computing the absolute orientation<a class="headerlink" href="#computing-the-absolute-orientation" title="Permalink to this headline"></a></h2>
<p>At this point, we’re ready to compute the absolute orientation of the images - taking them from the relative geometry to the real world.</p>
<p>To do this, we need to find a number of Ground Control Points (GCPs), which will help the software solve the absolute orientation of the cameras, and compute the 3-dimensional location for each pixel in the images.</p>
<p>To help save some time, and because finding GCPs in 30+ year old aerial photos can be difficult, I’ve provided a number of GCPs that you should be able to find in the images. In your folder, you should have a file, <strong>GCPs.txt</strong>, which contains the name and x, y, and z location for the GCPs. To make the file usable by MicMac, you need to convert it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mm3d</span> <span class="n">GCPConvert</span> <span class="n">AppInFile</span> <span class="n">GCPs</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>This will create a file, <strong>GCPs.xml</strong>, which MicMac will read to do the calibration. Before we can do that, though, we have to find the image locations for each of the GCPs. <strong>GCPs.txt</strong> has 33 different points, picked from US Dept of Agriculture <a class="reference external" href="https://www.fsa.usda.gov/programs-and-services/aerial-photography/imagery-programs/naip-imagery/">National Agriculture Imagery Program (NAIP) orthophotos</a>, which are provided in the directory NAIP_Images. Rather than trying to find each point individually, we can first use MicMac to estimate where each of the points should be. First, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mm3d</span> <span class="n">SaisieAppuisInitQT</span> <span class="s2">&quot;OIS-Reech_AR5840034159995.tif&quot;</span> <span class="n">Relative</span> <span class="n">id_gcps</span><span class="o">.</span><span class="n">txt</span> <span class="n">MeasuresInit</span><span class="o">.</span><span class="n">xml</span>
</pre></div>
</div>
<p>This will open the window shown below:</p>
<a class="reference internal image-reference" href="../../../_images/gcp0.png"><img alt="the first GCP input window" class="align-center" src="../../../_images/gcp0.png" style="width: 600px;" /></a>
<p>You might also want to see what the GCPs actually look like on the ground. To do this, you can load the NAIP Imagery into either <strong>QGIS</strong> or <strong>ArcGIS</strong>. You can add the images individually, or you can add them all at once using the Virtual Raster (<strong>mtsthelens.vrt</strong>), which should work for either software.</p>
<p>To display <strong>GCPs.txt</strong> in QGIS, you can add them as a <strong>Delimited Text Layer</strong>. Choose <strong>Custom Delimiter</strong> under <strong>File Format</strong>, and set the delimiter to <cite>Space</cite>. Under <strong>Record and Fields Options</strong>, set the <strong>Number of header lines to discard</strong> as <code class="docutils literal notranslate"><span class="pre">2</span></code>, and uncheck <strong>First record has field names</strong>. Set <code class="docutils literal notranslate"><span class="pre">field_2</span></code> to be the <strong>X field</strong>, and <code class="docutils literal notranslate"><span class="pre">field_3</span></code> to be the <strong>Y field</strong>. Finally, set the <strong>Geometry CRS</strong> to be <code class="docutils literal notranslate"><span class="pre">EPSG:32610</span> <span class="pre">–</span> <span class="pre">WGS84/UTM</span> <span class="pre">zone</span> <span class="pre">10N</span></code>, as shown below, then click <strong>Add</strong>:</p>
<a class="reference internal image-reference" href="../../../_images/qgis_import.png"><img alt="the qgis import as text dialogue" class="align-center" src="../../../_images/qgis_import.png" style="width: 600px;" /></a>
<p>This will load the points into the map. You can also display the names of the points (<strong>field_1</strong> in the example above) as labels, so that you know which point is which on the map.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To load the points in ArcMap or ArcGIS Pro, you might first need to replace the spaces in the text file with commas. You may also need to replace the first two lines:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#F= N X Y Z</span>
<span class="c1">#Here the coordinates are in UTM 10N X=Easting Y=Northing Z=Altitude</span>
</pre></div>
</div>
<p>with the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span>
</pre></div>
</div>
<p>To be on the safe side, I recommend copying the file <strong>GCPs.txt</strong> to <strong>GCPs.csv</strong> before making these changes, as you will need the original txt file later on in the practical.</p>
</div>
<p>We’ll start by inputting <strong>GCP0</strong>. This GCP is the junction of two forest roads to the southwest of the mountain (but in the upper left of image <strong>9996</strong>, in the far upper left of image <strong>9997</strong>, and in the upper center of image <strong>9995</strong>). Open image <strong>9995</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mm3d</span> <span class="n">SaisieAppuisInitQT</span> <span class="s2">&quot;OIS-Reech_AR5840034159995.tif&quot;</span> <span class="n">Relative</span> <span class="n">id_gcps</span><span class="o">.</span><span class="n">txt</span> <span class="n">MeasuresInit</span><span class="o">.</span><span class="n">xml</span>
</pre></div>
</div>
<p>then zoom in toward the upper middle of the image <strong>9995</strong>. The junction should look like this:</p>
<a class="reference internal image-reference" href="../../../_images/gcp0_location.png"><img alt="the first GCP" class="align-center" src="../../../_images/gcp0_location.png" style="width: 400px;" /></a>
<p>As with the fiducial marks, click the point name in the table on the right (<strong>GCP0</strong>), then click on its location in the image. Close the window (<strong>File</strong> &gt; <strong>Exit</strong>). Next, open image <strong>9996</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mm3d</span> <span class="n">SaisieAppuisInitQT</span> <span class="s2">&quot;OIS-Reech_AR5840034159996.tif&quot;</span> <span class="n">Relative</span> <span class="n">id_gcps</span><span class="o">.</span><span class="n">txt</span> <span class="n">MeasuresInit</span><span class="o">.</span><span class="n">xml</span>
</pre></div>
</div>
<p>You should see that the point <strong>GCP0</strong> is now displayed in <strong>9996</strong>, but it’s not quite in the correct location, and it’s yellow rather than green. Zoom in on the marker, then hold down the <strong>CTRL</strong> button and click and drag the marker to the correct location. When you’re satisfied with its location, right-click and select <code class="docutils literal notranslate"><span class="pre">Validate</span></code> – it should turn green.</p>
<p>To start with, we’ll only put in a few of the GCPs. I recommend doing <strong>GCP6</strong> next – you should be able to find it in images <strong>9996</strong>, <strong>9997</strong>, and <strong>9998</strong>. It should look something like this:</p>
<a class="reference internal image-reference" href="../../../_images/gcp6.png"><img alt="the second GCP" class="align-center" src="../../../_images/gcp6.png" style="width: 600px;" /></a>
<p>Close the window, and open up image <strong>9997</strong>. Here, you should be able to find both <strong>GPC0</strong> and <strong>GCP6</strong>, as well as <strong>GCP13</strong> in the lower right corner of the image:</p>
<a class="reference internal image-reference" href="../../../_images/image9997.png"><img alt="image 9997 showing 2 GCPs located" class="align-center" src="../../../_images/image9997.png" style="width: 600px;" /></a>
<p>Continue on to images <strong>9998</strong> and <strong>9999</strong>. Once you have put in these GCPs (<strong>GCP0</strong>, <strong>GCP6</strong> and <strong>GCP13</strong>), you can run the <code class="docutils literal notranslate"><span class="pre">GCPBascule</span></code> command to make a rough estimate of where the remaining GCPs should fall in each of the images:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mm3d</span> <span class="n">GCPBascule</span> <span class="s2">&quot;OIS.*tif&quot;</span> <span class="n">Relative</span> <span class="n">TerrainInit</span> <span class="n">GCPs</span><span class="o">.</span><span class="n">xml</span> <span class="n">MeasuresInit</span><span class="o">-</span><span class="n">S2D</span><span class="o">.</span><span class="n">xml</span>
</pre></div>
</div>
<p>This will compute a rough transformation between the relative geometry and the real-world coordinates. You should see something like this in the <strong>Command Prompt</strong> window:</p>
<a class="reference internal image-reference" href="../../../_images/bascule_output.png"><img alt="the end of the output of GCP Bascule" class="align-center" src="../../../_images/bascule_output.png" style="width: 600px;" /></a>
<p>There are a few things to note here. The first is the output for the individual points, which you can see at the top of the image. If you’ve only put in <strong>GCP0</strong>, <strong>GCP6</strong>, and <strong>GCP13</strong>, you’ll only see residual information for those points - the rest will look like what we see for <strong>GCP5</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">====</span> <span class="n">ADD</span> <span class="n">Pts</span> <span class="n">GCP5</span> <span class="n">Has</span> <span class="n">Gr</span> <span class="mi">1</span> <span class="n">Inc</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">NOT</span> <span class="n">OK</span> <span class="p">(</span><span class="n">UPL</span><span class="p">)</span> <span class="n">FOR</span> <span class="n">GCP5</span> <span class="p">,</span> <span class="n">Reason</span> <span class="n">NoPb</span>
</pre></div>
</div>
<p>What this shows that <strong>GCP5</strong> is not used (“NOT OK”), with the reason given that there are no points to work with (“NoPb”). Below that, you can see the output for <strong>GCP6</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">====</span> <span class="n">ADD</span> <span class="n">Pts</span> <span class="n">GCP6</span> <span class="n">Has</span> <span class="n">Gr</span> <span class="mi">1</span> <span class="n">Inc</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="o">--</span><span class="n">NamePt</span> <span class="n">GCP6</span> <span class="n">Ec</span> <span class="n">Estim</span><span class="o">-</span><span class="n">Ter</span> <span class="p">[</span><span class="o">-</span><span class="mf">4.50946</span><span class="p">,</span><span class="mf">2.33578</span><span class="p">,</span><span class="o">-</span><span class="mf">2.32917</span><span class="p">]</span>           <span class="n">Dist</span> <span class="o">=</span><span class="mf">5.58714</span> <span class="n">ground</span> <span class="n">units</span>
<span class="n">Inc</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="n">PdsIm</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e+08</span><span class="p">,</span><span class="mf">1e+08</span><span class="p">,</span><span class="mf">1e+08</span><span class="p">]</span>
    <span class="n">Ecart</span> <span class="n">Estim</span><span class="o">-</span><span class="n">Faisceaux</span> <span class="mf">0.00155021</span> <span class="n">Ter</span><span class="o">-</span><span class="n">Faisceau</span> <span class="p">[</span><span class="mf">4.50878</span><span class="p">,</span><span class="o">-</span><span class="mf">2.33578</span><span class="p">,</span><span class="mf">2.32778</span><span class="p">]</span> <span class="n">D</span><span class="o">=</span> <span class="mf">5.58601</span>
      <span class="n">ErrMoy</span> <span class="mf">0.0844219</span> <span class="n">pixels</span>  <span class="n">Nb</span> <span class="n">measures</span><span class="o">=</span><span class="mi">3</span>
     <span class="n">ErrMax</span> <span class="o">=</span> <span class="mf">0.011786</span> <span class="n">pixels</span><span class="p">,</span> <span class="n">For</span> <span class="n">Im</span><span class="o">=</span><span class="n">OIS</span><span class="o">-</span><span class="n">Reech_AR5840034159996</span><span class="o">.</span><span class="n">tif</span><span class="p">,</span>  <span class="n">Point</span><span class="o">=</span><span class="n">GCP6</span>
</pre></div>
</div>
<p>Starting from the bottom:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ErrMax</span> <span class="o">=</span> <span class="mf">0.011786</span> <span class="n">pixels</span><span class="p">,</span> <span class="n">For</span> <span class="n">Im</span><span class="o">=</span><span class="n">OIS</span><span class="o">-</span><span class="n">Reech_AR5840034159996</span><span class="o">.</span><span class="n">tif</span><span class="p">,</span>  <span class="n">Point</span><span class="o">=</span><span class="n">GCP6</span>
</pre></div>
</div>
<p>This says that the estimated maximum error (<code class="docutils literal notranslate"><span class="pre">ErrMax</span></code>) is 0.011786 pixels, and that’s the measurement taken from image <strong>OIS-Reech_AR5840034159996.tif</strong>.</p>
<p>The line before that:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ErrMoy</span> <span class="mf">0.0844219</span> <span class="n">pixels</span>  <span class="n">Nb</span> <span class="n">measures</span><span class="o">=</span><span class="mi">3</span>
</pre></div>
</div>
<p>Says that the average pixel error (<code class="docutils literal notranslate"><span class="pre">ErrMoy</span></code>) is 0.0844219 pixels, and that there are 3 images where GCP6 has been input (<code class="docutils literal notranslate"><span class="pre">Nb</span> <span class="pre">measures=3</span></code>). On the second line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">NamePt</span> <span class="n">GCP6</span> <span class="n">Ec</span> <span class="n">Estim</span><span class="o">-</span><span class="n">Ter</span> <span class="p">[</span><span class="o">-</span><span class="mf">4.50946</span><span class="p">,</span><span class="mf">2.33578</span><span class="p">,</span><span class="o">-</span><span class="mf">2.32917</span><span class="p">]</span>           <span class="n">Dist</span> <span class="o">=</span><span class="mf">5.58714</span> <span class="n">ground</span> <span class="n">units</span>
</pre></div>
</div>
<p>This tells us that for this point (<strong>GCP6</strong>), the difference between the best estimate and the “true” location (<code class="docutils literal notranslate"><span class="pre">Estim-Ter</span></code>) is -4.50946 ground units (meters) in the <em>x</em> direction, 2.33578 m in the <em>y</em> direction, and -2.32917 m in the <em>z</em> direction, for a total distance (<span class="math notranslate nohighlight">\(\sqrt{{\Delta}x^2 + {\Delta}y^2 + {\Delta}y^2}\)</span>) of 5.58714 m. The total distance (<strong>Dist</strong>) is then 5.58714 “ground units” - since we’re working with UTM points, this would be meters.</p>
<p>Below that line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Ecart</span> <span class="n">Estim</span><span class="o">-</span><span class="n">Faisceaux</span> <span class="mf">0.00155021</span> <span class="n">Ter</span><span class="o">-</span><span class="n">Faisceau</span> <span class="p">[</span><span class="mf">4.50878</span><span class="p">,</span><span class="o">-</span><span class="mf">2.33578</span><span class="p">,</span><span class="mf">2.32778</span><span class="p">]</span> <span class="n">D</span><span class="o">=</span> <span class="mf">5.58601</span>
</pre></div>
</div>
<p>This tells us that the difference between the position estimated from the “true” location and the bundle adjustment (<code class="docutils literal notranslate"><span class="pre">Ter-Faisceau</span></code>) is 4.50878 ground units (meters) in the <em>x</em> direction, -2.33578 m in the <em>y</em> direction, and 2.32778 m in the <em>z</em> direction, for a total distance (<span class="math notranslate nohighlight">\(\sqrt{{\Delta}x^2 + {\Delta}y^2 + {\Delta}y^2}\)</span>) of 5.58601 m.</p>
<p>Finally, at the very bottom, we see the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">==============================</span> <span class="n">ERRROR</span> <span class="n">MAX</span> <span class="n">PTS</span> <span class="n">FL</span> <span class="o">=====================</span>
<span class="o">||</span>     <span class="n">Value</span><span class="o">=</span><span class="mf">0.505585</span> <span class="k">for</span> <span class="n">Cam</span><span class="o">=</span><span class="n">OIS</span><span class="o">-</span><span class="n">Reech_AR584003415997</span><span class="o">.</span><span class="n">tif</span> <span class="ow">and</span> <span class="n">Pt</span><span class="o">=</span><span class="n">GCP0</span> <span class="p">;</span> <span class="n">MoyErr</span><span class="o">=</span><span class="mf">0.244851</span>
<span class="o">======================================================================</span>
</pre></div>
</div>
<p>This gives us the summary for the entire set of GCPs and images. Here, we can see that the maximum error is 0.505585 pixels for <strong>GCP0</strong> in image <strong>OIS-Reech_AR5840034159997.tif</strong>, and the average error for all points in all images (<strong>MoyErr</strong>) is 0.244851 pixels.</p>
<p>As long as your errors aren’t very large (both <strong>ErrMax</strong> and <strong>MoyErr</strong> &lt; 2 pixels or so), you can move on to the next steps. If you have large (residual) errors, you’ll need to carefully check the locations of your GCPs. By reading the report for each GCP, you can see which image has the largest residual for each point, and try to correct the points to improve the overall residual.</p>
<p>The next step is to run <code class="docutils literal notranslate"><span class="pre">SaisieAppuisPredicQT</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mm3d</span> <span class="n">SaisieAppuisPredicQT</span> <span class="s2">&quot;OIS-Reech_AR584003415999[4-7].tif&quot;</span> <span class="n">TerrainInit</span> <span class="n">GCPs</span><span class="o">.</span><span class="n">xml</span> <span class="n">MeasuresFinales</span><span class="o">.</span><span class="n">xml</span>
</pre></div>
</div>
<p>This will place markers at their approximate locations in the images, making it easier to find the control points in the image. Note that the parameter <code class="docutils literal notranslate"><span class="pre">&quot;OIS-Reech_AR584003415999[4-7].tif&quot;</span></code> will open 4 images (<strong>9994</strong>, <strong>9995</strong>, <strong>9996</strong>, and <strong>9997</strong>), which can be memory-intensive. If need be, you can proceed one image at a time, or by only opening 2 images (e.g., replace <code class="docutils literal notranslate"><span class="pre">&quot;OIS-Reech_AR584003415999[4-7].tif&quot;</span></code> with <code class="docutils literal notranslate"><span class="pre">&quot;OIS-Reech_AR584003415999[4-5].tif&quot;</span></code> to only open images <strong>9994</strong> and <strong>9995</strong>). The window should now look something like this (note that the image order may be different – if you look just above the table on the right-hand side, you can see which image is which by hovering over them):</p>
<a class="reference internal image-reference" href="../../../_images/saisie_predict.jpg"><img alt="the saisiepredict window, showing 4 images plus predicted gcp locations" class="align-center" src="../../../_images/saisie_predict.jpg" style="width: 600px;" /></a>
<p>From here, locate and validate as many of the points as you can – it’s not strictly necessary to do all of them, but it can help to improve the final results. I recommend trying to do at least a few of the ones at higher elevations, for reasons that should be clear from the lectures. Remember to check the orthoimages provided to be sure you’re finding the right points – don’t just accept the estimated locations. Once you’ve accepted points from the first four images (<strong>9994</strong>-<strong>9997</strong>), you’ll need to exit Saisie (<strong>File</strong> &gt; <strong>Exit</strong>), and re-run the command to input points to the remaining images:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mm3d</span> <span class="n">SaisieAppuisPredicQT</span> <span class="s2">&quot;OIS-Reech_AR584003415999[6-9].tif&quot;</span> <span class="n">TerrainInit</span> <span class="n">GCPs</span><span class="o">.</span><span class="n">xml</span> <span class="n">MeasuresFinales</span><span class="o">.</span><span class="n">xml</span>
</pre></div>
</div>
</div>
<div class="section" id="bundle-adjustment">
<h2>bundle adjustment<a class="headerlink" href="#bundle-adjustment" title="Permalink to this headline"></a></h2>
<p>Once you’ve input enough GCPs (at least 10), you can run <code class="docutils literal notranslate"><span class="pre">GCPBascule</span></code> again, which will refine the transformation estimated in the previous steps:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mm3d</span> <span class="n">GCPBascule</span> <span class="s2">&quot;OIS.*tif&quot;</span> <span class="n">TerrainInit</span> <span class="n">TerrainBrut</span> <span class="n">GCPs</span><span class="o">.</span><span class="n">xml</span> <span class="n">MeasuresFinales</span><span class="o">-</span><span class="n">S2D</span><span class="o">.</span><span class="n">xml</span>
</pre></div>
</div>
<p>Check the output of <code class="docutils literal notranslate"><span class="pre">GCPBascule</span></code>, using the information in the previous section, and make sure that there aren’t any large outliers.</p>
<p>As long as the <code class="docutils literal notranslate"><span class="pre">GCPBascule</span></code> output looks okay, the next step is to run <code class="docutils literal notranslate"><span class="pre">Campari</span></code>, which will perform the bundle adjustment and refine the camera calibration even further:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mm3d</span> <span class="n">Campari</span> <span class="s2">&quot;OIS.*tif&quot;</span> <span class="n">TerrainBrut</span> <span class="n">TerrainFinal</span> <span class="n">GCP</span><span class="o">=</span><span class="p">[</span><span class="n">GCPs</span><span class="o">.</span><span class="n">xml</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">MeasuresFinales</span><span class="o">-</span><span class="n">S2D</span><span class="o">.</span><span class="n">xml</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="n">SH</span><span class="o">=</span><span class="n">HomolMasqFiltered</span> <span class="n">AllFree</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
<p>This will take the orientation estimated in <code class="docutils literal notranslate"><span class="pre">Ori-TerrainBrut</span></code> [we drop the <code class="docutils literal notranslate"><span class="pre">Ori-</span></code> when entering the command], and create a new orientation directory, <code class="docutils literal notranslate"><span class="pre">Ori-TerrainFinal</span></code>. The numerical values in the GCP option (<code class="docutils literal notranslate"><span class="pre">5</span></code> and <code class="docutils literal notranslate"><span class="pre">2</span></code> in <code class="docutils literal notranslate"><span class="pre">GCP=[GCPs.xml,5,MeasuresFinales-S2D.xml,2]</span></code>) are the estimate of the GCP accuracy in world coordinates (first number) and in pixels (second number).</p>
<p>For now, I recommend keeping them at these default values, but feel free to experiment after you’ve gotten the hang of it somewhat.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">SH=HomolMasqFiltered</span></code> flag tells <code class="docutils literal notranslate"><span class="pre">Campari</span></code> to use the tie points found in <code class="docutils literal notranslate"><span class="pre">HomolMasqFiltered</span></code> - if you haven’t done the <code class="docutils literal notranslate"><span class="pre">HomolFilterMasq</span></code> step, leave this flag out. Finally, the <code class="docutils literal notranslate"><span class="pre">AllFree=1</span></code> flag means that we’re also refining the camera calibration (focal length, principal point location, radial distortion), in addition to resolving the camera orientations.</p>
<p>The output for <code class="docutils literal notranslate"><span class="pre">Campari</span></code> is iterative, meaning that it will go through several steps. At the end of the output, you should see something like this (note that you may need to scroll up):</p>
<a class="reference internal image-reference" href="../../../_images/campari_output.png"><img alt="the output of campari" class="align-center" src="../../../_images/campari_output.png" style="width: 400px;" /></a>
<p>The information for each GCP looks fairly similar to the output for <code class="docutils literal notranslate"><span class="pre">GCPBascule</span></code>. Taking the output for <strong>GCP6</strong> again:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">====</span> <span class="n">ADD</span> <span class="n">Pts</span> <span class="n">GCP6</span> <span class="n">Has</span> <span class="n">Gr</span> <span class="mi">1</span> <span class="n">Inc</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
<span class="o">--</span><span class="n">NamePt</span> <span class="n">GCP6</span> <span class="n">Ec</span> <span class="n">Estim</span><span class="o">-</span><span class="n">Ter</span> <span class="p">[</span><span class="o">-</span><span class="mf">3.47157</span><span class="p">,</span><span class="o">-</span><span class="mf">1.35434</span><span class="p">,</span><span class="o">-</span><span class="mf">0.48158</span><span class="p">]</span>           <span class="n">Dist</span> <span class="o">=</span><span class="mf">3.75739</span> <span class="n">ground</span> <span class="n">units</span>
<span class="n">Inc</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span><span class="n">PdsIm</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.25</span><span class="p">]</span>
    <span class="n">Ecart</span> <span class="n">Estim</span><span class="o">-</span><span class="n">Faisceaux</span> <span class="mf">4.92851</span> <span class="n">Ter</span><span class="o">-</span><span class="n">Faisceau</span> <span class="p">[</span><span class="mf">4.1262</span><span class="p">,</span><span class="mf">1.5956</span><span class="p">,</span><span class="mf">5.36046</span><span class="p">]</span> <span class="n">D</span><span class="o">=</span> <span class="mf">6.95026</span>
      <span class="n">ErrMoy</span> <span class="mf">0.595718</span> <span class="n">pixels</span>  <span class="n">Nb</span> <span class="n">measures</span><span class="o">=</span><span class="mi">3</span>
     <span class="n">ErrMax</span> <span class="o">=</span> <span class="mf">0.871427</span> <span class="n">pixels</span><span class="p">,</span> <span class="n">For</span> <span class="n">Im</span><span class="o">=</span><span class="n">OIS</span><span class="o">-</span><span class="n">Reech_AR5840034159997</span><span class="o">.</span><span class="n">tif</span><span class="p">,</span>  <span class="n">Point</span><span class="o">=</span><span class="n">GCP6</span>
</pre></div>
</div>
<p>We can see that the maximum error (<strong>ErrMax</strong>) of 0.871427 pixels is found in image <strong>OIS-Reech_AR5840034159997.tif</strong>, and the average pixel error of 3 measurements is 0.595718 pixels. The difference between the initial estimate and the “true” location (in <em>x</em>, <em>y</em>, <em>z</em>) is -3.47157 m, -1.35434 m, -0.48158 m, for a total distance of 3.75739 m. The difference between the “true” location and the predicted location after the bundle adjustment (again in <em>x</em>, <em>y</em>, <em>z</em>) is 4.1262 m, 1.5956 m, 5.36046 m, for a total distance of 6.95026 m.</p>
<p>As with <code class="docutils literal notranslate"><span class="pre">GCPBascule</span></code>, we can see the maximum error for all points in all images:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">=============================</span> <span class="n">ERRROR</span> <span class="n">MAX</span> <span class="n">PTS</span> <span class="n">FL</span> <span class="o">======================</span>
<span class="o">||</span>    <span class="n">Value</span><span class="o">=</span><span class="mf">3.2908</span> <span class="k">for</span> <span class="n">Cam</span><span class="o">=</span><span class="n">OIS</span><span class="o">-</span><span class="n">Reech_AR5840034159995</span><span class="o">.</span><span class="n">tif</span> <span class="ow">and</span> <span class="n">Pt</span><span class="o">=</span><span class="n">GCP4</span> <span class="p">;</span> <span class="n">MoyErr</span><span class="o">=</span><span class="mf">1.0297</span>
<span class="o">======================================================================</span>
</pre></div>
</div>
<p>In this case, the maximum error is 3.2908 pixels for <strong>GCP4</strong> in image <strong>OIS-Reech_AR5840034159995.tif</strong>, and the average error (<strong>MoyErr</strong>) for all points in all images is 1.0297 pixels. These are generally acceptable errors, though you might want to try working on correcting these further.</p>
<p>The next block of output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RES</span><span class="p">:[</span><span class="n">OIS</span><span class="o">-</span><span class="n">Reech_AR5840034159994</span><span class="o">.</span><span class="n">tif</span><span class="p">][</span><span class="n">C</span><span class="p">]</span> <span class="n">ER2</span> <span class="mf">0.705727</span> <span class="n">Nn</span> <span class="mf">99.7638</span> <span class="n">Of</span> <span class="mi">2963</span> <span class="n">Mul</span> <span class="mi">334</span> <span class="n">Mul</span><span class="o">-</span><span class="n">NN</span> <span class="mi">334</span> <span class="n">Time</span> <span class="mf">0.0899999</span>
<span class="n">RES</span><span class="p">:[</span><span class="n">OIS</span><span class="o">-</span><span class="n">Reech_AR5840034159995</span><span class="o">.</span><span class="n">tif</span><span class="p">][</span><span class="n">C</span><span class="p">]</span> <span class="n">ER2</span> <span class="mf">0.781405</span> <span class="n">Nn</span> <span class="mf">99.6569</span> <span class="n">Of</span> <span class="mi">6121</span> <span class="n">Mul</span> <span class="mi">1910</span> <span class="n">Mul</span><span class="o">-</span><span class="n">NN</span> <span class="mi">1907</span> <span class="n">Time</span> <span class="mf">0.189</span>
<span class="n">RES</span><span class="p">:[</span><span class="n">OIS</span><span class="o">-</span><span class="n">Reech_AR5840034159996</span><span class="o">.</span><span class="n">tif</span><span class="p">][</span><span class="n">C</span><span class="p">]</span> <span class="n">ER2</span> <span class="mf">0.734471</span> <span class="n">Nn</span> <span class="mf">99.7058</span> <span class="n">Of</span> <span class="mi">11895</span> <span class="n">Mul</span> <span class="mi">5307</span> <span class="n">Mul</span><span class="o">-</span><span class="n">NN</span> <span class="mi">5298</span> <span class="n">Time</span> <span class="mf">0.386</span>
<span class="n">RES</span><span class="p">:[</span><span class="n">OIS</span><span class="o">-</span><span class="n">Reech_AR5840034159997</span><span class="o">.</span><span class="n">tif</span><span class="p">][</span><span class="n">C</span><span class="p">]</span> <span class="n">ER2</span> <span class="mf">0.727616</span> <span class="n">Nn</span> <span class="mf">99.7086</span> <span class="n">Of</span> <span class="mi">12696</span> <span class="n">Mul</span> <span class="mi">5826</span> <span class="n">Mul</span><span class="o">-</span><span class="n">NN</span> <span class="mi">5815</span> <span class="n">Time</span> <span class="mf">0.471</span>
<span class="n">RES</span><span class="p">:[</span><span class="n">OIS</span><span class="o">-</span><span class="n">Reech_AR5840034159998</span><span class="o">.</span><span class="n">tif</span><span class="p">][</span><span class="n">C</span><span class="p">]</span> <span class="n">ER2</span> <span class="mf">0.737522</span> <span class="n">Nn</span> <span class="mf">99.7247</span> <span class="n">Of</span> <span class="mi">10897</span> <span class="n">Mul</span> <span class="mi">4329</span> <span class="n">Mul</span><span class="o">-</span><span class="n">NN</span> <span class="mi">4321</span> <span class="n">Time</span> <span class="mf">0.338</span>
<span class="n">RES</span><span class="p">:[</span><span class="n">OIS</span><span class="o">-</span><span class="n">Reech_AR5840034159999</span><span class="o">.</span><span class="n">tif</span><span class="p">][</span><span class="n">C</span><span class="p">]</span> <span class="n">ER2</span> <span class="mf">0.732468</span> <span class="n">Nn</span> <span class="mf">99.7965</span> <span class="n">Of</span> <span class="mi">4914</span> <span class="n">Mul</span> <span class="mi">929</span> <span class="n">Mul</span><span class="o">-</span><span class="n">NN</span> <span class="mi">928</span> <span class="n">Time</span> <span class="mf">0.145</span>
</pre></div>
</div>
<p>Looks very similar to the output from <code class="docutils literal notranslate"><span class="pre">Tapas</span></code>. Each line tells us the total residual (in pixels) for all of the tie points found in each image (<strong>ER2</strong>), as well as the percentage of tie points out of the total number of tie points in each image (<strong>Nn XX of XX</strong>) that were correct within the maximum acceptable error before a point is considered an outlier. It also shows how many points are seen in &gt; 2 images (<strong>Mul</strong>), and the number of points that were properly located (<strong>Mul-NN</strong>), as well as the time it took to do the calculation.</p>
<p>As long as the residual for each image is fairly low (&lt; 2 or so), and the percentage is reasonably close to 100, you should be able to continue to the next step and get usable, if not perfect, results.</p>
<p>And finally, we can see the stats for the whole block of images:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-----</span> <span class="n">Stat</span> <span class="n">on</span> <span class="nb">type</span> <span class="n">of</span> <span class="n">point</span> <span class="p">(</span><span class="n">ok</span><span class="o">/</span><span class="n">elim</span><span class="p">)</span> <span class="o">----</span>
     <span class="o">*</span>   <span class="n">Perc</span><span class="o">=</span><span class="mf">99.7171</span><span class="o">%</span> <span class="p">;</span>  <span class="n">Nb</span><span class="o">=</span><span class="mi">49346</span> <span class="k">for</span> <span class="n">Ok</span>
     <span class="o">*</span>   <span class="n">Perc</span><span class="o">=</span><span class="mf">0.282908</span><span class="o">%</span> <span class="p">;</span>  <span class="n">Nb</span><span class="o">=</span><span class="mi">140</span> <span class="k">for</span> <span class="n">PdsResNull</span>
<span class="o">---------------------------------------</span>
<span class="o">|</span> <span class="o">|</span>  <span class="n">Residual</span> <span class="o">=</span> <span class="mf">0.736882</span> <span class="p">;;</span> <span class="n">Evol</span><span class="p">,</span> <span class="n">Moy</span><span class="o">=</span><span class="mf">9.74916e-09</span> <span class="p">,</span><span class="n">Max</span><span class="o">=</span><span class="mf">9.14609e-08</span>
<span class="o">|</span> <span class="o">|</span>  <span class="n">Worst</span><span class="p">,</span> <span class="n">Res</span> <span class="mf">0.781405</span> <span class="k">for</span> <span class="n">OIS</span><span class="o">-</span><span class="n">Reech_AR5840034159995</span><span class="o">.</span><span class="n">tif</span><span class="p">,</span>  <span class="n">Perc</span> <span class="mf">99.6569</span> <span class="k">for</span> <span class="n">OIS</span><span class="o">-</span><span class="n">Reech_AR5840034159995</span><span class="o">.</span><span class="n">tif</span>
<span class="o">|</span> <span class="o">|</span>  <span class="n">Cond</span> <span class="p">,</span> <span class="n">Aver</span> <span class="mf">9.24052</span> <span class="n">Max</span> <span class="mf">58.2018</span> <span class="n">Prop</span><span class="o">&gt;</span><span class="mi">100</span> <span class="mi">0</span>
</pre></div>
</div>
<p>This says that 99.7171% of all tie points (49346 points) were “Ok” - that is, using the calibrated camera model and orientation, the location of each point agreed with the predicted location within the maximum allowable error before the points are considered outliers. Only 0.282908% of points (140 points) had an invalid residual - it helps that the images have a fair amount of texture, without large featureless areas.</p>
<p>Below this, we see the total residual for all points in all images was 0.736882 - this indicates that the cameras are generally well-calibrated, and the images are well-placed. If the residual is very high (&gt; 2 or so), you’ll need to work on improving the placement of your GCPs, using the individual report for each GCP as detailed above.</p>
<p>You can also see that the “Worst” residual was 0.781405 for image <strong>OIS-Reech_AR5840034159995.tif</strong> - if the residual for an individual image is high, this is a hint as to where you should try to check the positioning of your GCPs.</p>
<p>As before, if the errors here are large, or the percentage of “Ok” points is very low, check the report for the individual GCPs to see which one(s) might need to be re-positioned, and in which image(s). Once you’ve attempted to correct the position in each image, be sure to run <code class="docutils literal notranslate"><span class="pre">SaisiePredicQT</span></code> again, followed by <code class="docutils literal notranslate"><span class="pre">GCPBascule</span></code> and <code class="docutils literal notranslate"><span class="pre">Campari</span></code>, before moving on to the next steps.</p>
</div>
<div class="section" id="dem-extraction-and-orthophoto-generation">
<h2>dem extraction and orthophoto generation<a class="headerlink" href="#dem-extraction-and-orthophoto-generation" title="Permalink to this headline"></a></h2>
<p>The next step is to extract the DEM and create the orthophotomosaic. First, run <code class="docutils literal notranslate"><span class="pre">Malt</span></code> to do the DEM extraction and create the individual orthophotos:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mm3d</span> <span class="n">Malt</span> <span class="n">Ortho</span> <span class="s2">&quot;OIS.*tif&quot;</span> <span class="n">TerrainFinal</span> <span class="n">MasqImGlob</span><span class="o">=</span><span class="n">filtre</span><span class="o">.</span><span class="n">tif</span> <span class="n">NbVI</span><span class="o">=</span><span class="mi">2</span> <span class="n">ZoomF</span><span class="o">=</span><span class="mi">1</span> <span class="n">DefCor</span><span class="o">=</span><span class="mi">0</span> <span class="n">CostTrans</span><span class="o">=</span><span class="mi">4</span> <span class="n">EZA</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
<p>This will create two folders, <strong>MEC-Malt</strong> and <strong>Ortho-MEC-Malt</strong>. In <strong>MEC-Malt</strong>, you will find the DEM (<strong>Z_Num9_DeZoom1_STD-MALT.tif</strong>), as well as the correlation image (<strong>Correl_STD-MALT_Num_8.tif</strong>) and the image mask (<strong>AutoMask_STD-MALT_Num_8.tif</strong>). This will also take some time, depending on your computer – on my laptop, it takes around 10-15 minutes for this set of images.</p>
<p>At the end, you can load the final DEM (<strong>Z_Num9_DeZoom1-STD-MALT.tif</strong>) into <strong>QGIS</strong> or <strong>ArcGIS</strong>. The image below shows a comparison between my results (hillshade, red profile line) and the Shuttle Radar Topography Mission (SRTM) DEM (black line):</p>
<a class="reference internal image-reference" href="../../../_images/dem_comparison.png"><img alt="a profile comparison of the two dems" class="align-center" src="../../../_images/dem_comparison.png" style="width: 600px;" /></a>
<p>In <strong>Ortho-MEC-Malt</strong>, you will find an orthorectified version of each of the input images (e.g., <strong>Ort_OIS-Reech…</strong>). To create an orthophoto mosaic, you can run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mm3d</span> <span class="n">Tawny</span> <span class="n">Ortho</span><span class="o">-</span><span class="n">MEC</span><span class="o">-</span><span class="n">Malt</span> <span class="n">Out</span><span class="o">=</span><span class="n">Orthophotomosaic</span><span class="o">.</span><span class="n">tif</span>
</pre></div>
</div>
<p>This will create a mosaicked version of the images, which you can open using <strong>QGIS</strong> or <strong>ArcGIS</strong>.</p>
</div>
<div class="section" id="cleaning-up-the-outputs">
<h2>cleaning up the outputs<a class="headerlink" href="#cleaning-up-the-outputs" title="Permalink to this headline"></a></h2>
<p>The final step (for now) is to clean up the output DEM and Orthophoto, masking out the parts of the DEM raster that aren’t covered by the images.</p>
<p>First, cd into <strong>MEC-Malt</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">MEC</span><span class="o">-</span><span class="n">Malt</span>
</pre></div>
</div>
<p>Now, copy the <strong>.tfw</strong> file for the DEM to <strong>Correl_STD-MALT_Num_8.tfw</strong> and <strong>AutoMask_STD-MALT_Num_8.tfw</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">copy</span> <span class="n">Z_Num9_DeZoom1_STD</span><span class="o">-</span><span class="n">MALT</span><span class="o">.</span><span class="n">tfw</span> <span class="n">Correl_STD</span><span class="o">-</span><span class="n">MALT_Num_8</span><span class="o">.</span><span class="n">tfw</span>
<span class="n">copy</span> <span class="n">Z_Num9_DeZoom1_STD</span><span class="o">-</span><span class="n">MALT</span><span class="o">.</span><span class="n">tfw</span> <span class="n">AutoMask_STD</span><span class="o">-</span><span class="n">MALT_Num_8</span><span class="o">.</span><span class="n">tfw</span>
</pre></div>
</div>
<p>This will create a worldfile for both the correlation mask and the AutoMask, enabling you to load them into <strong>QGIS</strong> or <strong>ArcGIS</strong>. If you haven’t already, open <strong>QGIS</strong> (or <strong>ArcGIS</strong>), and add these three raster files to the map.</p>
<p>Open the <strong>Raster Calculator</strong>. If you are using <strong>ArcGIS</strong>, skip to the next line below. If you are using <strong>QGIS</strong>, enter the following expression:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;Z_Num9_DeZoom1_STD-MALT@1&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="s2">&quot;AutoMask_STD-MALT_Num_8@1&quot;</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../../_images/qgis_rastercalc.png"><img alt="the qgis raster calculator window" class="align-center" src="../../../_images/qgis_rastercalc.png" style="width: 600px;" /></a>
<p>This will mask the parts of the DEM that aren’t valid (i.e., <strong>MicMac</strong> wasn’t able to resolve an elevation for them).</p>
<p>If you are using <strong>ArcGIS</strong>, enter the following expression into the <strong>Raster Calculator</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SetNull</span><span class="p">(</span><span class="s2">&quot;AutoMask_STD-MALT_Num_8.tif&quot;</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Z_Num9_DeZoom1_STD-MALT.tif&quot;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../../_images/arcgis_rastercalc.png"><img alt="the arcgis raster calculator window" class="align-center" src="../../../_images/arcgis_rastercalc.png" style="width: 600px;" /></a>
<p>Save the masked DEM to your directory as <strong>MtStHelens_DEM.tif</strong> (or similar).</p>
<p>At this point, you’re done – we’ll work a bit more on analyzing our DEMs in the <a class="reference external" href="week2.html">week 2 practical</a>.</p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="setup.html" class="btn btn-neutral float-left" title="software setup" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="week2.html" class="btn btn-neutral float-right" title="week 2 - dem differencing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Bob McNabb.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>