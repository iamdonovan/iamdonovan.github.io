<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>week 5 - classification in earth engine &mdash; iamdonovan  documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="additional resources" href="../resources.html" />
    <link rel="prev" title="week 4 - change detection in earth engine" href="week4.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> iamdonovan
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../whataboutbob.html">about me</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">teaching and related resources</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../index.html#unis-spring-2017">unis (spring 2017)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../index.html#esa-cryosphere-training-course-june-2018">esa cryosphere training course (june 2018)</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html#ulster-2020-present">ulster (2020-present)</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../egm310/index.html">EGM310: introduction to gis and remote sensing</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">EGM702: photogrammetry and advanced image analysis</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../lectures.html">lectures</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="index.html">practicals</a></li>
<li class="toctree-l4"><a class="reference internal" href="../resources.html">additional resources</a></li>
<li class="toctree-l4"><a class="reference internal" href="../index.html#content">content</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../egm703/index.html">EGM703: advanced active and passive remote sensing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../egm722/index.html">EGM722: programming for gis and remote sensing</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../research/index.html">ongoing and past research projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../github.html">github projects</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">iamdonovan</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">teaching and related resources</a> &raquo;</li>
          <li><a href="../index.html">EGM702: photogrammetry and advanced image analysis</a> &raquo;</li>
          <li><a href="index.html">practicals</a> &raquo;</li>
      <li>week 5 - classification in earth engine</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/teaching/egm702/practicals/week5.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="week-5-classification-in-earth-engine">
<h1>week 5 - classification in earth engine<a class="headerlink" href="#week-5-classification-in-earth-engine" title="Permalink to this headline"></a></h1>
<div class="section" id="introduction">
<h2>introduction<a class="headerlink" href="#introduction" title="Permalink to this headline"></a></h2>
<p>In this practical, you’ll get an introduction to using Google Earth Engine (GEE) to do image classification. Just like the previous
weeks, you should be able to do finish the practical even if you have no prior experience with programming. All of the
programming steps have been provided for you in a script, and your task will be to run each step in turn and analyse and
interpret the results.</p>
</div>
<div class="section" id="getting-started">
<h2>getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline"></a></h2>
<p>To begin, import the script for this week by following <a class="reference external" href="https://code.earthengine.google.com/921bdf0b679cf3452bd5c11643b42eb4?noload=true">this link</a>
and saving it to your account. If you are not already logged in, you will need to log in using your GEE account.</p>
<p>When you open the script, you should see the following (you may have to zoom/pan to the study area; alternatively, run the
script to centre the map):</p>
<a class="reference internal image-reference" href="../../../_images/loaded_script1.png"><img alt="the gee window when the script has been loaded" class="align-center" src="../../../_images/loaded_script1.png" style="width: 600px;" /></a>
<p>You can see a number of points identified on the map – these represent the training points that we will use for the classification.
These individual feature collections represent the following things:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 76%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">water</span></code></p></td>
<td><p>surface water</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">forest</span></code></p></td>
<td><p>forest</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">clearCut</span></code></p></td>
<td><p>forest that has been cut down</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">newGrowth</span></code></p></td>
<td><p>new vegetation that has grown post-eruption</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Soil</span></code></p></td>
<td><p>eruptive material and soil</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Snow</span></code></p></td>
<td><p>snow</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="step-1-merging-training-data-and-loading-images">
<h2>step 1. merging training data and loading images<a class="headerlink" href="#step-1-merging-training-data-and-loading-images" title="Permalink to this headline"></a></h2>
<p>In the first lines of the script, you should see the following:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// merge all of the different training points into a single featurecollection</span>
<span class="kd">var</span> <span class="nx">trainingPoints</span> <span class="o">=</span> <span class="nx">water</span> <span class="c1">// landcover value 0</span>
  <span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">forest</span><span class="p">)</span> <span class="c1">// landcover value 1</span>
  <span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">clearCut</span><span class="p">)</span> <span class="c1">// landcover value 2</span>
  <span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">newGrowth</span><span class="p">)</span> <span class="c1">// landcover value 3</span>
  <span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">soil</span><span class="p">)</span> <span class="c1">// landcover value 4</span>
  <span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">snow</span><span class="p">);</span> <span class="c1">// landcover value 5</span>
  <span class="c1">//.merge(yourClass);</span>
</pre></div>
</div>
<p>This will merge each of the training points that you can see on the map above into a single <code class="docutils literal notranslate"><span class="pre">FeatureCollection</span></code>. Each of the points
has a property, <code class="docutils literal notranslate"><span class="pre">landcover</span></code>, with an associated value – for example, the value for the <code class="docutils literal notranslate"><span class="pre">water</span></code> class is <code class="docutils literal notranslate"><span class="pre">0</span></code>, for <code class="docutils literal notranslate"><span class="pre">forest</span></code> it’s <code class="docutils literal notranslate"><span class="pre">1</span></code>, and so on.
These are the training points we will use to run the Random Forest classification later in the practical. If you decide to add
additional landcover classes, you can do so by creating a new <code class="docutils literal notranslate"><span class="pre">FeatureCollection</span></code> from the <strong>Geometry Imports</strong> menu:</p>
<a class="reference internal image-reference" href="../../../_images/geometry_import.png"><img alt="the geometry import dialogue" class="align-center" src="../../../_images/geometry_import.png" style="width: 400px;" /></a>
<p>Be sure to give the new <code class="docutils literal notranslate"><span class="pre">FeatureCollection</span></code> a name, and add a property called <code class="docutils literal notranslate"><span class="pre">landcover</span></code> with a value that is not already being
used – for example, we have numbers 0-5 currently in use, so give the new class a value of <code class="docutils literal notranslate"><span class="pre">6</span></code>. As you add additional classes, be
sure to use unique values, or else your classification results will not make sense. The next lines:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">bands</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;B2&#39;</span><span class="p">,</span> <span class="s1">&#39;B3&#39;</span><span class="p">,</span> <span class="s1">&#39;B4&#39;</span><span class="p">,</span> <span class="s1">&#39;B5&#39;</span><span class="p">,</span> <span class="s1">&#39;B6&#39;</span><span class="p">,</span> <span class="s1">&#39;B7&#39;</span><span class="p">,</span>
  <span class="c1">//&#39;NDVI&#39;, &#39;NDWI&#39;, &#39;mNDWI&#39;, //uncomment to add NDVI, NDWI, mNDWI to classification</span>
  <span class="c1">//&#39;Slope&#39;, // uncomment to add slope as a classification parameter in Step 5</span>
  <span class="c1">//&#39;elevation&#39; // uncomment to add elevation as a classification parameter in Step 5</span>
<span class="p">];</span>
</pre></div>
</div>
<p>Will be used to select bands for the classification. To start with, we will use OLI Bands 2-7 (Visible/NIR/SWIR). Later, we will look
at the difference made by using spectral indices or elevation parameters. The final lines to look at in this section will add various
bands to the selected Landsat image:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// add NDVI, NDWI, mNDWI, and Slope layers to each of the training and test images</span>
<span class="nx">img</span> <span class="o">=</span> <span class="nx">img</span>
  <span class="p">.</span><span class="nx">addBands</span><span class="p">(</span><span class="nx">img</span><span class="p">.</span><span class="nx">normalizedDifference</span><span class="p">([</span><span class="s1">&#39;B5&#39;</span><span class="p">,</span> <span class="s1">&#39;B4&#39;</span><span class="p">]).</span><span class="nx">rename</span><span class="p">(</span><span class="s1">&#39;NDVI&#39;</span><span class="p">))</span>
  <span class="p">.</span><span class="nx">addBands</span><span class="p">(</span><span class="nx">img</span><span class="p">.</span><span class="nx">normalizedDifference</span><span class="p">([</span><span class="s1">&#39;B3&#39;</span><span class="p">,</span> <span class="s1">&#39;B5&#39;</span><span class="p">]).</span><span class="nx">rename</span><span class="p">(</span><span class="s1">&#39;NDWI&#39;</span><span class="p">))</span>
  <span class="p">.</span><span class="nx">addBands</span><span class="p">(</span><span class="nx">img</span><span class="p">.</span><span class="nx">normalizedDifference</span><span class="p">([</span><span class="s1">&#39;B3&#39;</span><span class="p">,</span> <span class="s1">&#39;B6&#39;</span><span class="p">]).</span><span class="nx">rename</span><span class="p">(</span><span class="s1">&#39;mNDWI&#39;</span><span class="p">))</span>
  <span class="p">.</span><span class="nx">addBands</span><span class="p">(</span><span class="nx">ee</span><span class="p">.</span><span class="nx">Terrain</span><span class="p">.</span><span class="nx">slope</span><span class="p">(</span><span class="nx">nasadem</span><span class="p">).</span><span class="nx">rename</span><span class="p">(</span><span class="s1">&#39;Slope&#39;</span><span class="p">))</span>
  <span class="p">.</span><span class="nx">addBands</span><span class="p">(</span><span class="nx">nasadem</span><span class="p">.</span><span class="nx">rename</span><span class="p">(</span><span class="s1">&#39;elevation&#39;</span><span class="p">))</span>
  <span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="nx">bands</span><span class="p">);</span>
</pre></div>
</div>
<p>Here, we’re using the <code class="docutils literal notranslate"><span class="pre">normalizedDifference()</span></code> function to calculate the NDVI, NDWI, and modified NDWI (mNDWI) and add each of
these to our image, as well as adding the Slope and elevation from the NASADEM to the image. When you run the script, it
should centre on Mt St Helens and add a false-colour composite of the OLI image to the map:</p>
<a class="reference internal image-reference" href="../../../_images/image_loaded.png"><img alt="the gee window with the first landsat image loaded" class="align-center" src="../../../_images/image_loaded.png" style="width: 600px;" /></a>
</div>
<div class="section" id="step-2-unsupervised-classification">
<h2>step 2. unsupervised classification<a class="headerlink" href="#step-2-unsupervised-classification" title="Permalink to this headline"></a></h2>
<p>Earth Engine provides methods to do both unsupervised and supervised classification. We’re going to start by doing an
unsupervised classification (clustering) on our OLI image, as it can help us to decide what classes it might make sense to use.</p>
<p>Rather than running the classification using all of the pixels in the image, we’ll take a random sample of 5000 pixels:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">training</span> <span class="o">=</span> <span class="nx">img</span><span class="p">.</span><span class="nx">sample</span><span class="p">({</span>
  <span class="nx">region</span><span class="o">:</span> <span class="nx">boundary</span><span class="p">,</span>
  <span class="nx">scale</span><span class="o">:</span> <span class="mf">30</span><span class="p">,</span>
  <span class="nx">numPixels</span><span class="o">:</span> <span class="mf">5000</span>
<span class="p">});</span>
</pre></div>
</div>
<p>This can help improve the performance of the clustering, but it also prevents us from causing <code class="docutils literal notranslate"><span class="pre">Out</span> <span class="pre">of</span> <span class="pre">Memory</span></code> errors when we
run our script – remember that we’re running this on an image with at least 7 bands, and even though we’ve clipped the image
to a size of 1070x1250 pixels, that still leaves a lot of values that the machine has to try to keep track of (1070x1250 = 1.33M
pixels).</p>
<p>The next lines:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// train the unsupervised clusterer with a maximum of 16 classes</span>
<span class="kd">var</span> <span class="nx">clusterer</span> <span class="o">=</span> <span class="nx">ee</span><span class="p">.</span><span class="nx">Clusterer</span><span class="p">.</span><span class="nx">wekaKMeans</span><span class="p">(</span><span class="mf">16</span><span class="p">).</span><span class="nx">train</span><span class="p">(</span><span class="nx">training</span><span class="p">);</span>

<span class="c1">// classify the image using the unsupervised classifier</span>
<span class="kd">var</span> <span class="nx">unsupervised</span> <span class="o">=</span> <span class="nx">img</span><span class="p">.</span><span class="nx">cluster</span><span class="p">(</span><span class="nx">clusterer</span><span class="p">);</span> <span class="c1">// returns an image with a single band, &#39;cluster&#39;</span>
</pre></div>
</div>
<p>Will run the <em>k</em>-means clustering algorithm on the sample of 5000 pixels. In this case, we’re telling the algorithm to use 16 classes
– you can try a few different values to get an idea for how changing this value changes the results of the clustering.</p>
<p>The following lines will sample the cluster values at each of the training points defined earlier, then plot a chart showing the
landcover value as a function of the cluster value. This will help us to determine whether it makes sense to use the landcover
values as we have defined them, as well as to determine whether our chosen training points represent spectrally distinct classes:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// sample the cluster values at each of the training points</span>
<span class="kd">var</span> <span class="nx">clusterPoints</span> <span class="o">=</span> <span class="nx">unsupervised</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;cluster&#39;</span><span class="p">).</span><span class="nx">sampleRegions</span><span class="p">({</span>
  <span class="nx">collection</span><span class="o">:</span> <span class="nx">trainingPoints</span><span class="p">,</span>
  <span class="nx">properties</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;landcover&#39;</span><span class="p">],</span>
  <span class="nx">scale</span><span class="o">:</span> <span class="mf">30</span>
<span class="p">});</span>

<span class="nx">print</span><span class="p">(</span><span class="nx">clusterPoints</span><span class="p">);</span>

<span class="c1">// create a chart that plots the cluster value vs the landcover class value</span>
<span class="c1">// for the training points</span>
<span class="kd">var</span> <span class="nx">chart</span> <span class="o">=</span> <span class="nx">ui</span><span class="p">.</span><span class="nx">Chart</span><span class="p">.</span><span class="nx">feature</span>
  <span class="p">.</span><span class="nx">byFeature</span><span class="p">({</span><span class="nx">features</span><span class="o">:</span> <span class="nx">clusterPoints</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;landcover|cluster&#39;</span><span class="p">),</span>
    <span class="nx">xProperty</span><span class="o">:</span> <span class="s1">&#39;cluster&#39;</span><span class="p">,</span>
    <span class="nx">yProperties</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;landcover&#39;</span><span class="p">]</span>
  <span class="p">}).</span><span class="nx">setChartType</span><span class="p">(</span><span class="s1">&#39;ScatterChart&#39;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">setOptions</span><span class="p">({</span>
    <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;cluster values by landcover&#39;</span><span class="p">,</span>
    <span class="nx">hAxis</span><span class="o">:</span> <span class="p">{</span><span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;cluster&#39;</span><span class="p">,</span> <span class="nx">titleTextStyle</span><span class="o">:</span> <span class="p">{</span><span class="nx">italic</span><span class="o">:</span> <span class="kc">false</span><span class="p">}},</span>
    <span class="nx">vAxis</span><span class="o">:</span> <span class="p">{</span><span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;landcover&#39;</span><span class="p">,</span> <span class="nx">titleTextStyle</span><span class="o">:</span> <span class="p">{</span><span class="nx">italic</span><span class="o">:</span> <span class="kc">false</span><span class="p">}},</span>
  <span class="p">});</span>
<span class="nx">print</span><span class="p">(</span><span class="nx">chart</span><span class="p">);</span>
</pre></div>
</div>
<p>When you run this section of the script, you will see the clustered image added to the map window, as well as the following
chart printed to the <strong>console</strong> panel (note that the order of these columns may change each time you re-run the script):</p>
<a class="reference internal image-reference" href="../../../_images/kmeans_chart.png"><img alt="the k-means cluster values for different landcover classes" class="align-center" src="../../../_images/kmeans_chart.png" style="width: 600px;" /></a>
<a class="reference internal image-reference" href="../../../_images/kmeans_image.png"><img alt="the k-means classified image" class="align-center" src="../../../_images/kmeans_image.png" style="width: 600px;" /></a>
<p>From this chart, you can see, for example, that cluster number 3 is identified as both landcover 0 (i.e., water) and 4 (soil). This
chart doesn’t tell us how many points belong to each; however, we can look at a confusion matrix of the landcover and cluster
values to learn a bit more:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">print</span><span class="p">(</span><span class="nx">clusterPoints</span><span class="p">.</span><span class="nx">errorMatrix</span><span class="p">(</span><span class="s1">&#39;landcover&#39;</span><span class="p">,</span> <span class="s1">&#39;cluster&#39;</span><span class="p">));</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../../_images/kmeans_error_matrix.png"><img alt="the confusion matrix for the k-means classification" class="align-center" src="../../../_images/kmeans_error_matrix.png" style="width: 400px;" /></a>
<p>Here, we can see that landcover 0 (the first row of the table) has 40 points identified as cluster type 3 (the fourth column of the
table), and no other values. Landcover 4 (the fifth row of the table) has 1 point identified as cluster type 3 – in other words,
cluster type 3 appears to correspond well to our water class.</p>
<p>Looking at the cluster types for landcover 4, we can see that most of the points are either cluster value 14 (13 points) or cluster
value 15 (20 points), with only a few points labelled; we can see a similar pattern for landcover 2 (clear cut), where most of the
points are identified as cluster value 0 or 1 (14 and 16 points, respectively). However, we can also see that landcover 3 (new
growth) also has a significant number of points in these cluster values, suggesting that there might be some overlap between
the chosen feature points for these two classes.</p>
<p>When we have large amounts of overlap between feature classes like this, we might want to think about what each of these
classes represent - what are the actual physical objects or surfaces that we’re trying to identify here? Is the difference between
‘new growth’ – i.e., vegetation that has started growing on land after the volcanic eruption, and ‘clear cut’ land a physical
difference, or a semantic difference? Remember that it can be very difficult to differentiate between different landcovers if the
difference is a semantic one, rather than a physical one – it might not make sense to try to differentiate between these different
classes, and instead combine them. This could also mean, however, that we’ve not done a great job selecting our training points,
and it might point to a need to do a better job selecting distinct training points.</p>
<p>Uncomment the second line of the <code class="docutils literal notranslate"><span class="pre">bands</span></code> variable and re-run the script. Does this make a difference in the clustering? What
about for the chart or confusion matrix comparing the landcover and cluster values for each training point?</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">bands</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;B2&#39;</span><span class="p">,</span> <span class="s1">&#39;B3&#39;</span><span class="p">,</span> <span class="s1">&#39;B4&#39;</span><span class="p">,</span> <span class="s1">&#39;B5&#39;</span><span class="p">,</span> <span class="s1">&#39;B6&#39;</span><span class="p">,</span> <span class="s1">&#39;B7&#39;</span><span class="p">,</span>
  <span class="s1">&#39;NDVI&#39;</span><span class="p">,</span> <span class="s1">&#39;NDWI&#39;</span><span class="p">,</span> <span class="s1">&#39;mNDWI&#39;</span><span class="p">,</span> <span class="c1">//uncomment to add NDVI, NDWI, mNDWI to classification</span>
  <span class="c1">//&#39;Slope&#39;, // uncomment to add slope as a classification parameter in Step 5</span>
  <span class="c1">//&#39;elevation&#39; // uncomment to add elevation as a classification parameter in Step 5</span>
<span class="p">];</span>
</pre></div>
</div>
<p>Re-comment this line after you’ve examined the results, and move on to the next section.</p>
</div>
<div class="section" id="step-3-train-different-classifiers">
<h2>step 3. train different classifiers<a class="headerlink" href="#step-3-train-different-classifiers" title="Permalink to this headline"></a></h2>
<p>The code in this section will help us run a Random Forest classification on our chosen image, and examine the results. The
following lines of code:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// select training points from the training image</span>
<span class="kd">var</span> <span class="nx">training</span> <span class="o">=</span> <span class="nx">img</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="nx">bands</span><span class="p">).</span><span class="nx">sampleRegions</span><span class="p">({</span>
  <span class="nx">collection</span><span class="o">:</span> <span class="nx">trainingPoints</span><span class="p">,</span>
  <span class="nx">properties</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;landcover&#39;</span><span class="p">],</span>
  <span class="nx">scale</span><span class="o">:</span> <span class="mf">30</span>
<span class="p">});</span>

<span class="c1">// split the training points into training, testing data</span>
<span class="kd">var</span> <span class="nx">split</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">withRandom</span> <span class="o">=</span> <span class="nx">training</span><span class="p">.</span><span class="nx">randomColumn</span><span class="p">(</span><span class="s1">&#39;random&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">trainingPartition</span> <span class="o">=</span> <span class="nx">withRandom</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">ee</span><span class="p">.</span><span class="nx">Filter</span><span class="p">.</span><span class="nx">lt</span><span class="p">(</span><span class="s1">&#39;random&#39;</span><span class="p">,</span> <span class="nx">split</span><span class="p">));</span>
<span class="kd">var</span> <span class="nx">testingPartition</span> <span class="o">=</span> <span class="nx">withRandom</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">ee</span><span class="p">.</span><span class="nx">Filter</span><span class="p">.</span><span class="nx">gte</span><span class="p">(</span><span class="s1">&#39;random&#39;</span><span class="p">,</span> <span class="nx">split</span><span class="p">));</span>
</pre></div>
</div>
<p>will select the image band values for each of the training points, then split them into training and test data using a 70-30 split
(i.e., 70% of the data will be used for training, 30% for testing).</p>
<p>The following lines of code will initialize a Random Forest classifier using 100 individual “trees” and train the classifier using the
training data.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// initialize a random forest with 100 &quot;trees&quot;</span>
<span class="kd">var</span> <span class="nx">classifier100</span> <span class="o">=</span> <span class="nx">ee</span><span class="p">.</span><span class="nx">Classifier</span><span class="p">.</span><span class="nx">smileRandomForest</span><span class="p">(</span><span class="mf">100</span><span class="p">).</span><span class="nx">train</span><span class="p">({</span>
  <span class="nx">features</span><span class="o">:</span> <span class="nx">trainingPartition</span><span class="p">,</span>
  <span class="nx">classProperty</span><span class="o">:</span> <span class="s1">&#39;landcover&#39;</span><span class="p">,</span>
  <span class="nx">inputProperties</span><span class="o">:</span> <span class="nx">bands</span>
<span class="p">});</span>
</pre></div>
</div>
<p>A second block of code will initialize a Random Forest classifier with only 10 trees, to enable us to compare the results of using
different numbers of trees.</p>
<p>Finally, we will classify the testing data, then look at the confusion matrix and accuracy
measurements to compare our different classifiers:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// classify the testing data using our trained classifiers</span>
<span class="kd">var</span> <span class="nx">test100</span> <span class="o">=</span> <span class="nx">testingPartition</span><span class="p">.</span><span class="nx">classify</span><span class="p">(</span><span class="nx">classifier100</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">test10</span> <span class="o">=</span> <span class="nx">testingPartition</span><span class="p">.</span><span class="nx">classify</span><span class="p">(</span><span class="nx">classifier10</span><span class="p">);</span>

<span class="c1">// make the confsuion matrix for the different test datasets</span>
<span class="kd">var</span> <span class="nx">cm100</span> <span class="o">=</span> <span class="nx">test100</span><span class="p">.</span><span class="nx">errorMatrix</span><span class="p">(</span><span class="s1">&#39;landcover&#39;</span><span class="p">,</span> <span class="s1">&#39;classification&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">cm10</span> <span class="o">=</span> <span class="nx">test10</span><span class="p">.</span><span class="nx">errorMatrix</span><span class="p">(</span><span class="s1">&#39;landcover&#39;</span><span class="p">,</span> <span class="s1">&#39;classification&#39;</span><span class="p">);</span>

<span class="c1">// print the confusion matricies, overall accuracy, and kappa statistics</span>
<span class="nx">print</span><span class="p">(</span><span class="s1">&#39;RF 100 error matrix: &#39;</span><span class="p">,</span> <span class="nx">cm100</span><span class="p">,</span>
  <span class="s1">&#39;RF100 accuracy: &#39;</span><span class="p">,</span> <span class="nx">cm100</span><span class="p">.</span><span class="nx">accuracy</span><span class="p">(),</span>
  <span class="s1">&#39;RF100 kappa: &#39;</span><span class="p">,</span> <span class="nx">cm100</span><span class="p">.</span><span class="nx">kappa</span><span class="p">());</span>
<span class="nx">print</span><span class="p">(</span><span class="s1">&#39;RF 10 error matrix: &#39;</span><span class="p">,</span> <span class="nx">cm10</span><span class="p">,</span>
  <span class="s1">&#39;RF10 accuracy: &#39;</span><span class="p">,</span> <span class="nx">cm10</span><span class="p">.</span><span class="nx">accuracy</span><span class="p">(),</span>
  <span class="s1">&#39;RF10 kappa: &#39;</span><span class="p">,</span> <span class="nx">cm10</span><span class="p">.</span><span class="nx">kappa</span><span class="p">());</span>
</pre></div>
</div>
<p>When you run the script, you should see the following in the <strong>console</strong> panels (remember that your results may differ slightly):</p>
<a class="reference internal image-reference" href="../../../_images/error_matrix.png"><img alt="the error matrix and accuracy values for the 100-tree random forest classification" class="align-center" src="../../../_images/error_matrix.png" style="width: 400px;" /></a>
<p>From this example, we can see that the overall accuracy is quite high (82.6%), with a reasonably high kappa statistics (0.788).
However, we can also see a significant overlap between the clear cut and new growth classes, as we suspected might happen
based on the results of the unsupervised classification.</p>
<p>Return to the <code class="docutils literal notranslate"><span class="pre">bands</span></code> variable, uncomment the second line again, and re-run the script. How does the result for the testing data
change? What about if you add slope and elevation data to the classification? Re-comment each of these lines before moving on
to the next section.</p>
</div>
<div class="section" id="step-4-classify-the-image-and-examine-the-results">
<h2>step 4. classify the image and examine the results<a class="headerlink" href="#step-4-classify-the-image-and-examine-the-results" title="Permalink to this headline"></a></h2>
<p>The code in this section will classify the image using the two classifiers trained and tested in the previous section:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">classified100</span> <span class="o">=</span> <span class="nx">img</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="nx">bands</span><span class="p">).</span><span class="nx">classify</span><span class="p">(</span><span class="nx">classifier100</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">classified10</span> <span class="o">=</span> <span class="nx">img</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="nx">bands</span><span class="p">).</span><span class="nx">classify</span><span class="p">(</span><span class="nx">classifier10</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">classPalette</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;013dd6&#39;</span><span class="p">,</span> <span class="s1">&#39;059e2a&#39;</span><span class="p">,</span> <span class="s1">&#39;a6613d&#39;</span><span class="p">,</span> <span class="s1">&#39;2aff53&#39;</span><span class="p">,</span> <span class="s1">&#39;e3d4ae&#39;</span><span class="p">,</span> <span class="s1">&#39;fffbf4&#39;</span><span class="p">];</span>

<span class="nx">Map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">classified10</span><span class="p">,</span> <span class="p">{</span><span class="nx">min</span><span class="o">:</span> <span class="mf">0</span><span class="p">,</span> <span class="nx">max</span><span class="o">:</span> <span class="mf">5</span><span class="p">,</span> <span class="nx">palette</span><span class="o">:</span> <span class="nx">classPalette</span><span class="p">},</span> <span class="s1">&#39;RF 10&#39;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">Map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">classified100</span><span class="p">,</span> <span class="p">{</span><span class="nx">min</span><span class="o">:</span> <span class="mf">0</span><span class="p">,</span> <span class="nx">max</span><span class="o">:</span> <span class="mf">5</span><span class="p">,</span> <span class="nx">palette</span><span class="o">:</span> <span class="nx">classPalette</span><span class="p">},</span> <span class="s1">&#39;RF 100&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</pre></div>
</div>
<p>Run the script and examine the results:</p>
<a class="reference internal image-reference" href="../../../_images/classified_image.png"><img alt="the random forest classified image" class="align-center" src="../../../_images/classified_image.png" style="width: 600px;" /></a>
<p>Note that when you are zoomed out, the classification will look different due to the way that the image is re-sampled at lower
resolutions. Zoom in on the peak. Are there significant differences between the different classified images (RF 100 and RF 10)?
What are they?</p>
<p>Re-run the script after adding the NDVI, NDWI, and mNDWI bands back to the image. How does the classified image change?
What about after adding the slope and elevation information?</p>
</div>
<div class="section" id="step-5-export-the-classified-image-s">
<h2>step 5. export the classified image(s)<a class="headerlink" href="#step-5-export-the-classified-image-s" title="Permalink to this headline"></a></h2>
<p>The code in this section will enable you to export the classified image to your Google Drive, and use them in, for example,
ArcGIS, QGIS, or ERDAS Imagine.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">Export</span><span class="p">.</span><span class="nx">image</span><span class="p">.</span><span class="nx">toDrive</span><span class="p">({</span><span class="nx">image</span><span class="o">:</span> <span class="nx">classified100</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;classification&#39;</span><span class="p">),</span>
  <span class="nx">description</span><span class="o">:</span> <span class="s1">&#39;RandomForestClassification&#39;</span><span class="p">,</span>
  <span class="nx">scale</span><span class="o">:</span> <span class="mf">30</span><span class="p">,</span>
  <span class="nx">region</span><span class="o">:</span> <span class="nx">boundary</span><span class="p">,</span>
  <span class="nx">crs</span><span class="o">:</span> <span class="s1">&#39;epsg:32610&#39;</span><span class="p">,</span>
  <span class="nx">maxPixels</span><span class="o">:</span> <span class="mf">1e12</span>
<span class="p">});</span>
</pre></div>
</div>
<p>You can change the image name (<code class="docutils literal notranslate"><span class="pre">classified100</span></code>) to export a different image, or duplicate this block of code to export multiple images.</p>
</div>
<div class="section" id="step-6-image-segmentation">
<h2>step 6. image segmentation<a class="headerlink" href="#step-6-image-segmentation" title="Permalink to this headline"></a></h2>
<p>run the bit to see what it looks like</p>
<dl class="simple">
<dt>run again with the second scale</dt><dd><ul class="simple">
<li><p>how does the scale affect the shape of the objects created?</p></li>
<li><p>think about size of “objects” you’re trying to identify</p></li>
</ul>
</dd>
<dt>add texture with GLCM</dt><dd><ul class="simple">
<li><p>explain ASM</p></li>
<li><p>explain Contrast</p></li>
<li><p>direct to literature/documentation for other info</p></li>
</ul>
</dd>
<dt>need to add:</dt><dd><ul class="simple">
<li><p>ASM, Contrast to snic image (and calculate mean value per cluster)</p></li>
<li><p>maybe elevation?</p></li>
</ul>
</dd>
<dt>use the classifier points from earlier to train a random forest classifier</dt><dd><ul class="simple">
<li><p>how does the result look vs the pixel-based?</p></li>
<li><p>compare accuracy</p></li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="step-7-support-vector-machine-classification">
<h2>step 7. support vector machine classification<a class="headerlink" href="#step-7-support-vector-machine-classification" title="Permalink to this headline"></a></h2>
<p>use obia, svm to classify water? glacier? forest?</p>
</div>
<div class="section" id="next-steps">
<h2>next steps<a class="headerlink" href="#next-steps" title="Permalink to this headline"></a></h2>
<p>The example classes provided may not adequately describe the image – can you think of any other classes it might make sense
to add to the classification? Try adding another class or two by including a number of training samples. Make sure that the
number of points between the training classes is somewhat balanced – otherwise, there is a chance that you will have
insufficient samples for training.</p>
<p>We have added a number of additional bands to the data in order to help classify the results. Can you think of any other spectral
indices or band ratios, either from the lectures or your own reading, that it might make sense to try to include?</p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="week4.html" class="btn btn-neutral float-left" title="week 4 - change detection in earth engine" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../resources.html" class="btn btn-neutral float-right" title="additional resources" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Bob McNabb. Licensed under Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0).</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>